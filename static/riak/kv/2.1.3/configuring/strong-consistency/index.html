<!DOCTYPE html>

<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"></html><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"></html><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"></html><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->




<head class="tutorials">
  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width">
  <meta name="project" content="riak_kv">
  <meta name="version" content="2.1.3">
  <meta name="base-url" content="">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  <title>Implementing Strong Consistency</title>

  <link href="/css/all.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/css/print.css" media="print" rel="stylesheet" type="text/css">

  
  <style type="text/css"> .js_enabled pre { visibility : hidden; } </style>
  <script type="text/javascript">
    document.documentElement.className = 'js_enabled';
  </script>
</head>



<body class="riak_kv 2.1.3 latest ">

  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-T9C8MK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-T9C8MK');</script>

  
<aside id="nav-container" role="complementary">
  <nav class="overview" id="primary-nav" role="nav">
    <div id="primary-nav-content">
      <h2 class="responsive-link"><a class="responsive-toggle"></a></h2>

      
      <form id="searchbox_011972015458788978446:zgdcy4fa-o0" action="">
        <div class="nav-field-container">
          <div id="icon-container-search">
            <div class="icon-container"><span aria-hidden="true" class="nav-icon-search icon-search"></span></div>
            <span class="separator">&#124;</span>
          </div>
          <input id="main-search" name="q" placeholder="Search" size="5" type="search" />
        </div>
      </form>

      <div class="clear"></div>

      
      <h3 class="responsive-link visit-basho">
        <a href="http://www.basho.com">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">Visit Basho</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      <h3 class="responsive-link">
        <a href="/index.html">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">All Riak Projects</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-riak"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/">Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-download-alt"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/downloads/">Download Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-install"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/setup/">Setup</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/">Planning</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/start/">Start Planning</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/operating-system/">OS Support</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/backend/">Choosing a Backend</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/bitcask/">Bitcask</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/leveldb/">LevelDB</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/memory/">Memory</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/multi/">Multi-backend</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/cluster-capacity/">Cluster Capacity</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/bitcask-capacity-calc/">Bitcask Capacity Calculator</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/future/">Planning for the Future</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/">Installing</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/amazon-web-services/">Amazon Web Services</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/debian-ubuntu/">Debian &amp; Ubuntu</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/freebsd/">FreeBSD</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/mac-osx/">Mac OS X</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/rhel-centos/">RHEL &amp; CentOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/smartos/">SmartOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/solaris/">Solaris</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/suse/">SUSE</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/windows-azure/">Windows Azure</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/source/">Installing From Source</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/erlang/">Installing Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/jvm/">Installing the JVM</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/verify/">Verifying an Installation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/upgrading/">Upgrading</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/checklist/">Production Checklist</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/version/">Upgrading by Version</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/cluster/">Upgrading a Cluster</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/multi-datacenter/">Upgrading Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/downgrade/">Downgrading</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-cog"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/configuring/">Configuring</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/basic/">Basic Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/backend/">Backend Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/managing/">Managing Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/reference/">Configuration Reference</a>
  
  </li>
  <li class="current">
  
    <a href="/riak/kv/2.1.3/configuring/strong-consistency/">Implementing Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/load-balancing-proxy/">Load Balancing &amp; Proxy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/mapreduce/">MapReduce Settings</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/search/">Search Settings</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/">V3 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/">V2 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-database"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/using/">Using</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/running-a-cluster/">Running a Cluster</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/admin/">Cluster Administration</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/commands/">Cluster Admin Commands</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-admin/">riak-admin CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-cli/">riak CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-control/">Riak Control</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/cluster-operations/">Cluster Operations</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/adding-removing-nodes/">Adding/Removing Nodes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/changing-cluster-info/">Changing Cluster Information</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/replacing-node/">Replacing a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/inspecting-node/">Inspecting a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backing-up/">Backing Up</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/secondary-indexes/">Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/monitoring-strong-consistency/">Monitoring Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/load-balancing/">Load Balancing</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backend/">Backend</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v3-multi-datacenter/">V3 Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v2-multi-datacenter/">V2 Multi-Datacenter</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/repair-recovery/">Repair &amp; Recovery</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/errors/">Errors</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/repairs/">Repairs</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/rolling-restart/">Rolling Restarts</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/security/">Security</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/basics/">Security Basics</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/managing-sources/">Managing Security Sources</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/v2-v3-ssl-ca/">V2/V3 SSL &amp; CA Validation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/performance/">Performance</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/benchmarking/">Benchmarking</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/open-files-limit/">Open Files Limit</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/v2-scheduling-fullsync/">V2 Scheduling Fullsync</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/multi-datacenter-tuning/">Multi-Datacenter Replication</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/">Troubleshooting</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/">Product Advisories</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/210-dataloss/">Default Configuration For Handoff May Cause Data Loss</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/appconfig-foward/">Forward Incompatibility of app.config</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/dvv-lastwritewins/">Incompatibility between Dotted Version Vectors and Last Write Wins</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/maps-204/">Map Data Type Disk Incompatibility</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/ssl-poodle/">SSL 3.0 Vulnerability and POODLE Attack</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/http-204/">HTTP 204</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/reference/">Reference</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/runtime-interaction/">Runtime Interaction</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/monitoring/">Monitoring</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/search-secondary-indexes/">Search &amp; Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/multi-datacenter/">Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v3/">V3 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v2/">V2 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/architecture/">Architecture</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-lambda"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/developing/">Developing</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/">Getting Started</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/java/">Java</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/ruby/">Ruby</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/python/">Python</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/csharp/">C Sharp</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/nodejs/">NodeJS</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/erlang/">Erlang</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/golang/">Go</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/php/">PHP</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/querying/">Querying</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/">Usage</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/creating-objects/">Creating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/reading-objects/">Reading Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/updating-objects/">Updating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/deleting-objects/">Deleting Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/content-types/">Content Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search/">Searching</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/mapreduce/">Using MapReduce</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/secondary-indexes/">Using Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/commit-hooks/">Using Commit Hooks</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search-schemas/">Creating Search Schemas</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/searching-data-types/">Searching with Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/document-store/">Implementing a Document Store</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/custom-extractors/">Custom Extractors</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/security/">Security</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/erlang/">Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/php/">PHP</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/replication/">Replication</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/">Conflict Resolution</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/csharp/">C Sharp</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/nodejs/">NodeJS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/php/">PHP</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/golang/">Go</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-types/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-modeling/">Data Modeling</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/app-guide/">Application Guide</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/replication-properties/">Replication Properties</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/write-once/">Write Once</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/reference/">Reference</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/client-libraries/">Client Libraries</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/api/">APIs</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/repl-hooks/">V2 Multi-Datacenter REPL Hooks API</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/backend/">Backend API</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/faq/">Developing FAQ</a>
  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-beaker"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/learn/">Learning</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/why-riak-kv/">Why Riak KV?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/use-cases/">Use Cases</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/new-to-nosql/">New to NoSQL?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/glossary/">Riak KV Glossary</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/learn/concepts/">Concepts</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/active-anti-entropy/">Active Anti-Entropy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/buckets/">Buckets</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/capability-negotiation/">Capability Negotiation</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/causal-context/">Causal Context</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/clusters/">Clusters</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/crdts/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/eventual-consistency/">Eventual Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/keys-and-objects/">Keys and Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/replication/">Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/vnodes/">Vnodes</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-comments"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/community">Community</a></span>
        <div class="clear"></div>
      </h3>
      <ul></ul> 
    </div>
  </nav>

  
  <ul id="fixed-nav">
    <li>
      <a href="https://github.com/basho/basho_docs" target="_blank">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xe004;"></span>
        </div>
        <span class="separator">&#124;</span>Available on GitHub
      </a>
    </li>
    <li>
      <a href="/riak/latest/community/">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xf059;"></span>
        </div>
        <span class="separator">&#124;</span>Get Help
      </a>
    </li>
  </ul>
</aside>


  <script>
  (function() {
    var cx = '011972015458788978446:zgdcy4fa-o0';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:0px;overflow:hidden;height:0px;">
  <gcse:search></gcse:search>
</div>


  <div role="main">

    <header class="masthead">
  <div id="header">
    
    <div id="header-inner">
      <div class="icon-reorder" id="nav-toggle"></div>

      <div id="top-nav">
        
        <a href="/riak/kv/2.1.3/downloads/"><span class="icon-download-alt"></span>Downloads</a>
        <div id="nav-more"><span class="icon-more"></span></div>
      </div>

      <a class="responsive-toggle"></a>
      
      
      <a class="logo" href="/index.html"><h1>Riak Docs</h1></a>
      
      <span class="tagline">Product tutorials, how-tos, and fully-documented APIs.</span>
      <div id="nav-menu">
        <h2>Links</h2>
        <ul>
          <li><a href="http://docs.basho.com/">Docs Home</a></li>
          <li><a href="http://basho.com/">Basho Website</a></li>
        </ul>
        
        <div id="nav-menu-arrow"></div>
        <div id="nav-menu-arrow-back"></div>
      </div>

      <div class="clear"></div>

      <div class="header-rule"></div>
    </div>
  </div>
</header>


    <article class="mainarticle">

      <div class="versions">
  <div id="version-ddown-button" class="unselected">
    <div class="version-ddown-title">Version</div>
    <div class="version-ddown-number">2.1.3</div>
    <div class="version-ddown-arrow"></div>
  </div>
  <ol id="version-list" style="display: none;">
  
  
    
    
      
      
      <li class="sans versions-0 current">DEV</li>
      
      <li class="current versions-0"><a class="versioned" href="/riak/kv/2.1.3/configuring/strong-consistency/">2.1.3</a></li>
    
    
      
      
      
      <li class=" versions-0 first"><a class="versioned" href="/riak/kv/2.1.1/configuring/strong-consistency/">2.1.1</a></li>
    
  
    
    
      
      
      
      <li class="sans versions-1 current">LTS</li>
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.6/configuring/strong-consistency/">2.0.6</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.5/configuring/strong-consistency/">2.0.5</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.4/configuring/strong-consistency/">2.0.4</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.2/configuring/strong-consistency/">2.0.2</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.1/configuring/strong-consistency/">2.0.1</a></li>
    
    
      
      
      
      <li class=" versions-1 first"><a class="versioned" href="/riak/kv/2.0.0/configuring/strong-consistency/">2.0.0</a></li>
    
  
  
  <li class="versions-5 first"><a class="sans versioned" href="http://docs.basho.com/riak/1.4.12/">older</a></li>
  </ol>
</div>


      
      

      <header><h1>Implementing Strong Consistency</h1></header>

      

      
      <nav id="toc">
        <h2 class="title">Contents</h2>
        <div id="toc-wrapper">
          <ol id="toc-items"></ol>
        </div>
      </nav>
      

      

<blockquote>
<p><strong>Please Note:</strong></p>

<p>Riak KV&rsquo;s strong consistency is an experimental feature and may be removed from the product in the future. Strong consistency is not commercially supported or production-ready. Strong consistency is incompatible with Multi-Datacenter Replication, Riak Search, Bitcask Expiration, LevelDB Secondary Indexes, Riak Data Types and Commit Hooks. We do not recommend its usage in any production environment.</p>
</blockquote>

<p>This document provides information on configuring and monitoring a Riak
cluster&rsquo;s optional strong consistency subsystem. Documentation for
developers building applications using Riak&rsquo;s strong consistency feature
can be found in <a href="/riak/kv/2.1.3/developing/app-guide/strong-consistency">Using Strong Consistency</a>, while a more theoretical
treatment can be found in <a href="/riak/kv/2.1.3/concepts/strong-consistency">Strong Consistency</a>.</p>

<h2 id="minimum-cluster-size:12852f79e49b73416cfd63bb30fc96d8">Minimum Cluster Size</h2>

<p>In order to use strong consistency in Riak, <strong>your cluster must consist
of at least three nodes</strong>. If it does not, all strongly consistent
operations will fail. If your cluster is smaller than three nodes, you
will need to <a href="/riak/kv/2.1.3/using/cluster-operations/adding-removing-nodes">add more nodes</a> and make sure
that strong consistency is <a href="#Enabling-Strong-Consistency">enabled</a> on all of them.</p>

<p>Strongly consistent operations on a given key may also fail if a
majority of object replicas in a given ensemble are unavailable, whether
due to slowness, crashes, or network partitions. This means that you may
see strongly consistent operations fail even if the minimum cluster size
requirement has been met. More information on ensembles can be found in
<a href="#Implementation-Details">Implementation Details</a>.</p>

<p>While strong consistency requires at least three nodes, we have a
variety of recommendations regarding cluster size, which can be found in
<a href="#Fault-Tolerance">Fault Tolerance</a>.</p>

<h2 id="enabling-strong-consistency:12852f79e49b73416cfd63bb30fc96d8">Enabling Strong Consistency</h2>

<p>Strong consistency in Riak is disabled by default. You can enable it in
each node&rsquo;s <a href="/riak/kv/2.1.3/configuring/reference/#Strong-Consistency">configuration files</a>.</p>

<pre><code class="language-riakconf">strong_consistency = on
</code></pre>

<pre><code class="language-appconfig">%% In the older, app.config-based system, the strong consistency
%% parameter is enable_consensus:

{riak_core, [
    % ...
    {enable_consensus, on},
    % ...
    ]}
</code></pre>

<p>Remember that you must <a href="/riak/kv/2.1.3/using/admin/riak-cli">restart your node</a> for
configuration changes to take effect.</p>

<p>For strong consistency requirements to be applied to specific keys,
those keys must be in [[buckets]] bearing a bucket type with the
<code>consistent</code> property set to <code>true</code>. More information can be found in
[[Using Bucket Types]].</p>

<p>If you enable strong consistency on all nodes in a cluster with fewer
than three nodes, strong consistency will be <strong>enabled</strong> but not yet
<strong>active</strong>. Strongly consistent operations are not possible in this
state. Once at least three nodes with strong consistency enabled are
detected in the cluster, the system will be activated and ready for use.
You can check on the status of the strong consistency subsystem using
the <code>[[riak-admin ensemble-status|Managing Strong
Consistency#riak-admin-ensemble-status]]</code> command.</p>

<h2 id="fault-tolerance:12852f79e49b73416cfd63bb30fc96d8">Fault Tolerance</h2>

<p>Strongly consistent operations in Riak are necessarily less highly
available than <a href="/riak/kv/2.1.3/concepts/eventual-consistency">eventually consistent</a> operations
because strongly consistent operations can only succeed if a <strong>quorum</strong>
of object replicas are currently reachable. A quorum can be expressed as
N / 2 + 1 (or <code>n_val</code> / 2 + 1), meaning that 3 replicas constitutes a
quorum if N=5, 4 replicas if N=7, etc. If N=7 and 4 replicas are
unavailable, for example, no strongly consistent operations on that
object can succeed.</p>

<p>While Riak uses N=3 by default, bear in mind that <strong>higher values of N
will allow for more fault tolerance</strong>. The table below shows the number
of allowable missing replicas for assorted values of N:</p>

<table>
<thead>
<tr>
<th align="left">Replicas</th>
<th align="left">Allowable missing replicas</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">3</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">5</td>
<td align="left">2</td>
</tr>

<tr>
<td align="left">7</td>
<td align="left">3</td>
</tr>

<tr>
<td align="left">9</td>
<td align="left">4</td>
</tr>

<tr>
<td align="left">15</td>
<td align="left">7</td>
</tr>
</tbody>
</table>

<p>Thus, we recommend setting <code>n_val</code> higher than the default of 3 for
strongly consistent operations. More on <code>n_val</code> in the section below.</p>

<h3 id="n-val-recommendations:12852f79e49b73416cfd63bb30fc96d8">n_val Recommendations</h3>

<p>Due to the quorum requirements explained above, we recommend that you
use <em>at least</em> N=5 for strongly consistent data. You can set the value
of N, i.e. <code>n_val</code>, for buckets [[using bucket types]]. For example, you
can create and activate a bucket type with N set to 5 and strong
consistency enabled&mdash;we&rsquo;ll call the bucket type
<code>consistent_and_fault_tolerant</code>&mdash;using the following series of
[[commands|riak-admin Command Line]]:</p>

<pre><code class="language-bash">riak-admin bucket-type create consistent_and_fault_tolerant \
  '{&quot;props&quot;: {&quot;consistent&quot;:true,&quot;n_val&quot;:5}}'
riak-admin bucket-type activate consistent_and_fault_tolerant
</code></pre>

<p>If the <code>activate</code> command outputs <code>consistent_and_fault_tolerant has
been activated</code>, the bucket type is now ready to provide strong
consistency guarantees.</p>

<h4 id="setting-the-target-n-val-parameter:12852f79e49b73416cfd63bb30fc96d8">Setting the target_n_val parameter</h4>

<p>The <code>target_n_val</code> parameter sets the highest <code>n_val</code> that you intend to
use in an entire cluster. The purpose of this parameter is to ensure
that so-called &ldquo;hot spots&rdquo; don&rsquo;t occur, i.e. that data is never stored
more than once on the same physical node. This can happen when:</p>

<ul>
<li><code>target_n_val</code> is greater than the number of physical nodes, or</li>
<li>the <code>n_val</code> for a bucket is greater than <code>target_n_val</code>.</li>
</ul>

<p>A problem to be aware of if you&rsquo;re using strong consistency is that the
default for <code>target_n_val</code> is 4, while our suggested minimum <code>n_val</code> for
strongly consistent bucket types is 5. This means that you will need to
raise <code>target_n_val</code> if you intend to use an <code>n_val</code> over 4 for <em>any</em>
bucket type in your cluster. If you anticipate using an <code>n_val</code> of 7 as
the largest <code>n_val</code> within your cluster, for example, you will need to
set <code>target_n_val</code> to 7.</p>

<p>This setting is not contained in <code>riak.conf</code>, and must instead be set in
the <code>advanced.config</code> file. For more information, see our documentation
on [[advanced configuration|Configuration
Files#Advanced-Configuration]].</p>

<p>If you are using strong consistency in a cluster that has already been
created with a <code>target_n_val</code> that is too low (remember that the default
is too low), you will need to raise it to the desired higher value and
restart each node.</p>

<h4 id="note-on-bucket-properties:12852f79e49b73416cfd63bb30fc96d8">Note on Bucket Properties</h4>

<p>The <code>consistent</code> bucket property is one of two bucket properties,
alongside <code>[[datatype|Using Data Types]]</code>, that cannot be changed once a
bucket type has been created.</p>

<p>Furthermore, if <code>consistent</code> is set to <code>true</code> for a bucket type, you
cannot change the <code>n_val</code> for the bucket type once it&rsquo;s been created. If
you attempt to do so, you&rsquo;ll see the following error:</p>

<pre><code>Error updating bucket &lt;bucket_type_name&gt;:
n_val cannot be modified for existing consistent type
</code></pre>

<p>If you&rsquo;ve created a bucket type with a specific <code>n_val</code> and wish to
change it, you will need to create a new bucket type with the
appropriate <code>n_val</code> and use the new bucket type instead.</p>

<h3 id="fault-tolerance-and-cluster-size:12852f79e49b73416cfd63bb30fc96d8">Fault Tolerance and Cluster Size</h3>

<p>From the standpoint of strongly consistent operations, larger clusters
tend to be more fault tolerant. Spreading [[ensembles|Managing Strong
Consistency#Implementation-Details]] across more nodes will decrease the
number of ensembles active on each node and thus decrease the number of
quorums affected when a node goes down.</p>

<p>Imagine a 3-node cluster in which all ensembles are N=3 ensembles. If
two nodes go down, <em>all</em> ensembles will lose quorum and will be unable
to function. Strongly consistent operations on the entire keyspace will
fail until at least one node is brought back online. And even when that
one node is brought back online, a significant portion of the keyspace
will continue to be unavailable for strongly consistent operations.</p>

<p>For the sake of contrast, imagine a 50-node cluster in which all
ensembles are N=5 (i.e. all objects are replicated to five nodes).  In
this cluster, each node is involved in only 10% of the total ensembles;
if a single node fails, that failure will thus impact only 10% of
ensembles. In addition, because N is set to 5, that will not impact
quorum for <em>any</em> ensemble in the cluster; two additional node failures
would need to occur for quorum to be lost for <em>any</em> ensemble.  And even
in the case of three nodes failing, it is highly unlikely that that
failure would impact the same ensembles; if it did, only those ensembles
would become unavailable, affecting only 10% of the key space, as
opposed to 100% in the example of a 3-node cluster consisting of N=3
ensembles.</p>

<p>These examples illustrate why we recommend higher values for N&mdash;again,
at least N=5&mdash;as well as clusters with many nodes. The 50-node cluster
example above is used only to illustrate why larger clusters are more
fault tolerant. The definition of &ldquo;many&rdquo; nodes will vary according to your needs.
For recommendations regarding cluster size, see [[Cluster Capacity
Planning]].</p>

<h3 id="offline-node-recommendations:12852f79e49b73416cfd63bb30fc96d8">Offline Node Recommendations</h3>

<p>In general, strongly consistent Riak is more sensitive to the number of
nodes in the cluster than eventually consistent Riak, due to the quorum
requirements described above. While Riak is designed to withstand a
variety of failure scenarios that make nodes in the cluster unreachable,
such as hardware or network failure, <strong>we nonetheless recommend that you
limit the number of nodes that you intentionally down or reboot</strong>.
Having multiple nodes leave the cluster at once can threaten quorum and
thus affect the viability of some or all strongly consistent operations,
depending on the size of the cluster.</p>

<p>If you&rsquo;re using strong consistency and you do need to reboot multiple
nodes, we recommend rebooting them very carefully. Rebooting nodes too
quickly in succession can force the cluster to lose quorum and thus be
unable to service strongly consistent operations. The best strategy is
to reboot nodes one at a time and wait for each node to rejoin existing
[[ensembles|Managing Strong Consistency#Implementation-Details]] before
continuing to the next node. At any point in time, the state of
currently existing ensembles can be checked using <code>[[riak-admin
ensemble-status|Managing Strong
Consistency#riak-admin-ensemble-status]]</code>.</p>

<h2 id="performance:12852f79e49b73416cfd63bb30fc96d8">Performance</h2>

<p>If you run into performance issues, bear in mind that the key space in a
Riak cluster is spread across multiple [[consensus groups|Strong
Consistency#Implementation-Details]], each of which manages a portion of
that key space. Larger [[ring sizes|Clusters#The-Ring]] allow more
independent consensus groups to exist in a cluster, which can provide
for more concurrency and higher throughput, and thus better performance.
The ideal ring size, however, will also depend on the number of nodes in
the cluster. General recommendations can be found in [[Cluster Capacity
Planning|Cluster Capacity Planning#Ring-Size-Number-of-Partitions]].</p>

<p>Adding nodes to your cluster is another means of enhancing the
performance of strongly consistent operations. Instructions on doing so
can be found in [[Adding and Removing Nodes]].</p>

<p>Your cluster&rsquo;s configuration can also affect strong consistency
performance. See the section on [[configuration|Managing Strong
Consistency#Configuring-Strong-Consistency]] below.</p>

<h2 id="riak-admin-ensemble-status:12852f79e49b73416cfd63bb30fc96d8">riak-admin ensemble-status</h2>

<p>The <code>[[riak-admin|riak-admin Command Line#ensemble-status]]</code> interface
used for general node/cluster management has an <code>ensemble-status</code>
command that provides insight into the current status of the consensus
subsystem undergirding strong consistency.</p>

<p>Running the command by itself will provide the current state of the
subsystem:</p>

<pre><code class="language-bash">riak-admin ensemble-status
</code></pre>

<p>If strong consistency is not currently enabled, you will see <code>Note: The
consensus subsystem is not enabled.</code> in the output of the command; if
strong consistency is enabled, you will see output like this:</p>

<pre><code>============================== Consensus System ===============================
Enabled:     true
Active:      true
Ring Ready:  true
Validation:  strong (trusted majority required)
Metadata:    best-effort replication (asynchronous)

================================== Ensembles ==================================
 Ensemble     Quorum        Nodes      Leader
-------------------------------------------------------------------------------
   root       4 / 4         4 / 4      riak@riak1
    2         3 / 3         3 / 3      riak@riak2
    3         3 / 3         3 / 3      riak@riak4
    4         3 / 3         3 / 3      riak@riak1
    5         3 / 3         3 / 3      riak@riak2
    6         3 / 3         3 / 3      riak@riak2
    7         3 / 3         3 / 3      riak@riak4
    8         3 / 3         3 / 3      riak@riak4
</code></pre>

<h3 id="interpreting-ensemble-status-output:12852f79e49b73416cfd63bb30fc96d8">Interpreting ensemble-status Output</h3>

<p>The following table provides a guide to <code>ensemble-status</code> output:</p>

<table>
<thead>
<tr>
<th align="left">Item</th>
<th align="left">Meaning</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>Enabled</code></td>
<td align="left">Whether the consensus subsystem is enabled on the current node, i.e. whether the <code>strong_consistency</code> parameter in <code><a href="/ops/advanced/configs/configuration-files#Strong-Consistency">riak.conf</a></code> has been set to <code>on</code>. If this reads <code>off</code> and you wish to enable strong consistency, see our documentation on <a href="/ops/advanced/strong-consistency#Enabling-Strong-Consistency">enabling strong consistency</a>.</td>
</tr>

<tr>
<td align="left"><code>Active</code></td>
<td align="left">Whether the consensus subsystem is active, i.e. whether there are enough nodes in the cluster to use strong consistency, which requires at least three nodes.</td>
</tr>

<tr>
<td align="left"><code>Ring Ready</code></td>
<td align="left">If <code>true</code>, then all of the <a href="/riak/kv/2.1.3/learn/glossary/#Vnode">vnodes</a> in the cluster have seen the current <a href="/theory/concepts/clusters#The-Ring">ring</a>, which means that the strong consistency subsystem can be used; if <code>false</code>, then the system is not yet ready. If you have recently added or removed one or more nodes to/from the cluster, it may take some time for <code>Ring Ready</code> to change.</td>
</tr>

<tr>
<td align="left"><code>Validation</code></td>
<td align="left">This will display <code>strong</code> if the <code>tree_validation</code> setting in <code><a href="/ops/advanced/configs/configuration-files#Strong-Consistency">riak.conf</a></code> has been set to <code>on</code> and <code>weak</code> if set to <code>off</code>.</td>
</tr>

<tr>
<td align="left"><code>Metadata</code></td>
<td align="left">This depends on the value of the <code>synchronous_tree_updates</code> setting in <code><a href="/ops/advanced/configs/configuration-files#Strong-Consistency">riak.conf</a></code>, which determines whether strong consistency-related Merkle trees are updated synchronously or asynchronously. If <code>best-effort replication (asynchronous)</code>, then <code>synchronous_tree_updates</code> is set to <code>false</code>; if <code>guaranteed replication (synchronous)</code> then <code>synchronous_tree_updates</code> is set to <code>true</code>.</td>
</tr>

<tr>
<td align="left"><code>Ensembles</code></td>
<td align="left">This displays a list of all of the currently existing ensembles active in the cluster.<br /><ul><li><code>Ensemble</code> &mdash; The ID of the ensemble</li><li><code>Quorum</code> &mdash; The number of ensemble peers that are either leading or following</li><li><code>Nodes</code> &mdash; The number of nodes currently online</li><li><code>Leader</code> &mdash; The current leader node for the ensemble</li></ul></td>
</tr>
</tbody>
</table>

<p><strong>Note</strong>: The <strong>root ensemble</strong>, designated by <code>root</code> in the sample
output above, is a special ensemble that stores a list of nodes and
ensembles in the cluster.</p>

<p>More in-depth information on ensembles can be found in our <a href="https://github.com/basho/riak_ensemble/blob/develop/doc/Readme.md">internal
documentation</a>.</p>

<h3 id="inspecting-specific-ensembles:12852f79e49b73416cfd63bb30fc96d8">Inspecting Specific Ensembles</h3>

<p>The <code>ensemble-status</code> command also enables you to directly inspect the
status of specific ensembles in a cluster. The IDs for all current
ensembles are displayed in the <code>Ensembles</code> section of the
<code>ensemble-status</code> output described above.</p>

<p>To inspect a specific ensemble, specify the ID:</p>

<pre><code class="language-bash">riak-admin ensemble-status &lt;id&gt;
</code></pre>

<p>The following would inspect ensemble 2:</p>

<pre><code class="language-bash">riak-admin ensemble-status 2
</code></pre>

<p>Below is sample output for a single ensemble:</p>

<pre><code>================================= Ensemble #2 =================================
Id:           {kv,0,3}
Leader:       riak@riak2 (2)
Leader ready: true

==================================== Peers ====================================
 Peer  Status     Trusted          Epoch         Node
-------------------------------------------------------------------------------
  1    following    yes             1            riak@riak1
  2     leading     yes             1            riak@riak2
  3    following    yes             1            riak@riak3
</code></pre>

<p>The table below provides a guide to the output:</p>

<table>
<thead>
<tr>
<th align="left">Item</th>
<th align="left">Meaning</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>Id</code></td>
<td align="left">The ID for the ensemble used internally by Riak, expressed as a 3-tuple. All ensembles are <code>kv</code>; the second element names the ring partition for which the ensemble is responsible; and the third element is the <code>n_val</code> for the keys for which the ensemble is responsible.</td>
</tr>

<tr>
<td align="left"><code>Leader</code></td>
<td align="left">Identifies the ensemble&rsquo;s leader. In this case, the leader is on node <code>riak@riak2</code> and is identified as peer <code>2</code> in the ensemble.</td>
</tr>

<tr>
<td align="left"><code>Leader ready</code></td>
<td align="left">States whether the ensemble&rsquo;s leader is ready to respond to requests. If not, requests to the ensemble will fail.</td>
</tr>

<tr>
<td align="left"><code>Peers</code></td>
<td align="left">A list of peer <a href="/riak/kv/2.1.3/learn/glossary/#Vnode">vnodes</a> associated with the ensemble.<br /><ul><li><code>Peer</code> &mdash; The ID of the peer</li><li><code>Status</code> &mdash; Whether the peer is a leader or a follower</li><li><code>Trusted</code> &mdash; Whether the peer&rsquo;s Merkle tree is currently considered trusted or not</li><li><code>Epoch</code> &mdash; The current consensus epoch for the peer. The epoch is incremented each time the leader changes.</li><li><code>Node</code> &mdash; The node on which the peer resides.</li></ul></td>
</tr>
</tbody>
</table>

<p>More information on leaders, peers, Merkle trees, and other details can
be found in [[Implementation Details|Managing Strong
Consistency#Implementation-Details]] below.</p>

<h2 id="implementation-details:12852f79e49b73416cfd63bb30fc96d8">Implementation Details</h2>

<p>Strong consistency in Riak is handled by a subsystem called
<a href="https://github.com/basho/riak_ensemble/blob/develop/doc/Readme.md"><code>riak_ensemble</code></a>
This system functions differently from other systems in Riak in a number
of ways, and many of these differences are important to bear in mind for
operators configuring their cluster&rsquo;s usage of strong consistency.</p>

<h3 id="basic-operations:12852f79e49b73416cfd63bb30fc96d8">Basic Operations</h3>

<p>The first major difference is that strongly consistent Riak involves a
different set of operations from [[eventually consistent|Eventual
Consistency]] Riak. In strongly consistent buckets, there are four types
of atomic operations on objects:</p>

<ul>
<li><strong>Get</strong> operations work just as they do against
non-strongly-consistent keys, but with two crucial differences:

<ol>
<li>Connecting clients are guaranteed to return the most recently
written value (which makes those operations CP, i.e. consistent and
partition tolerant)</li>
<li>Reads on strongly consistent keys <em>never</em> return siblings, hence
there is no need to develop any sort of [[conflict resolution]]
strategy for those keys</li>
</ol></li>
<li><strong>Conditional put</strong> operations write an object only if no object
currently exists in that key. The operation will fail if the key
already exists; if the key was never written or has been deleted, the
operation succeeds.</li>
<li><strong>Conditional modify</strong> operations are compare-and-swap (CAS)
operations that succeed only if the value of a key has not changed
since it was previously read.</li>
<li><strong>Delete</strong> operations work mostly like they do against
non-strongly-consistent keys, with the exception that
[[tombstones|Object Deletion#Tombstones]] are not harvested, which is
the equivalent of having <code>delete_mode</code> set to <code>keep</code>.</li>
</ul>

<p><strong>From the standpoint of clients connecting to Riak, there is little
difference between strongly and non-strongly consistent data</strong>. The
operations performed on objects&mdash;reads, writes, deletes, etc.&mdash;are the
same, which means that the client API for strong consistency is
essentially the same as it is for eventually consistent operations, with
the important exception of [[error handling|Using Strong
Consistency#Error-Messages]].</p>

<h3 id="ensembles:12852f79e49b73416cfd63bb30fc96d8">Ensembles</h3>

<p>The main actors in Riak&rsquo;s implementation of strong consistency are
<strong>ensembles</strong>, which are independent groups that watch over a portion of
a Riak cluster&rsquo;s key space and coordinate strongly consistent operations
across nodes. When watching over a given key space, ensembles must act
upon multiple replicas of a given object, the number of which is
specified by <code>n_val</code> (more on this in [[Replication Properties]]).</p>

<p>Eventually consistent Riak can service requests even when only a single
object replica is available, using mechanisms like [[vector
clocks|Causal Context#Vector-Clocks]] and [[dotted version
vectors|Causal Context#Dotted-Version-Vectors]]&mdash;or, in a different
way, [[Riak Data Types|Data Types]])&mdash;to ensure eventual consistency
between replicas.  Strongly consistent Riak is different because it
requires that a <strong>quorum</strong> of object replicas be online and reachable,
where a quorum is defined as <code>n_val</code> / 2 + 1. <strong>If a quorum is not
available for a key, all strongly consistent operations against that key
will fail</strong>.</p>

<p>More information can be found in the section on [[Fault
Tolerance|Managing Strong Consistency#fault-tolerance]] above.</p>

<h3 id="peers-leaders-followers-and-workers:12852f79e49b73416cfd63bb30fc96d8">Peers, Leaders, Followers, and Workers</h3>

<p>All ensembles in strongly consistent Riak consist of agents called
<strong>peers</strong>. The number of peers in an ensemble is defined by the <code>n_val</code>
of that ensemble, i.e. the number of object replicas that the
ensemble watches over. Amongst the peers in the ensemble, there are two
basic actors: <strong>leaders</strong> and <strong>followers</strong>.</p>

<p>Leaders and followers coordinate with one another on most requests.
While leaders and followers coordinate on all writes, i.e. all puts and
deletes, you can enable leaders to respond to gets without the need to
coordinate with followers. This is known as granting a <strong>leader lease</strong>.
Leader leases are enabled by default, and are disabled (or re-enabled)
at the cluster level. A more in-depth account of ensemble behavior can
be found in our <a href="https://github.com/basho/riak_ensemble/tree/feature/add-docs/doc">internal
documentation</a>.</p>

<p>In addition to leaders and followers, ensemble peers use lightweight
Erlang processes called <strong>workers</strong> to perform long-running K/V
operations, allowing peers to remain responsive to requests. The number
of workers assigned to each peer depends on your configuration.</p>

<p>These terms should be borne in mind in the sections on configuration
below.</p>

<h3 id="integrity-checking:12852f79e49b73416cfd63bb30fc96d8">Integrity Checking</h3>

<p>An essential part of implementing a strong consistency subsystem in a
distributed system is <strong>integrity checking</strong>, which is a process that
guards against data corruption and inconsistency even in the face of
network partitions and other adverse events that Riak was built to
handle gracefully.</p>

<p>Like Riak&rsquo;s [[active anti-entropy]] subsystem, strong consistency
integrity checking utilizes <a href="http://en.wikipedia.org/wiki/Merkle_tree">Merkle
trees</a> that are persisted on
disk. All peers in an ensemble, i.e. all leaders and followers, maintain
their own Merkle trees and update those trees in the event of most
strongly consistent operations. Those updates can occur synchronously or
asynchronously from the standpoint of client operations, depending on
the configuration that you specify.</p>

<p>While integrity checking takes place automatically in Riak, there are
important aspects of its behavior that you can configure. See the <a
href="#merkle">Merkle Tree settings</a> section below for more
information on configurable parameters.</p>

<h2 id="configuring-strong-consistency:12852f79e49b73416cfd63bb30fc96d8">Configuring Strong Consistency</h2>

<p>The <code>riak_ensemble</code> subsystem provides a wide variety of tunable
parameters that you can adjust to fit the needs of your Riak cluster.
All <code>riak_ensemble</code>-specific parameters, with the exception of the
<code>strong_consistency</code> parameter used to [[enable strong
consistency|Managing Strong Consistency#Enabling-Strong-Consistency]],
must be set in each node&rsquo;s <code>advanced.config</code> file, <em>not</em> in <code>riak.conf</code>
or <code>app.config</code>.</p>

<p>Information on the syntax and usage of <code>advanced.config</code> can be found in
our documentation on [[advanced configuration|Configuration
Files#Advanced-Configuration]]. That same document also contains a full
listing of [[strong-consistency-related configuration
parameters|Configuration Files#Strong-Consistency]].</p>

<p>Please note that the sections below require a basic understanding of the
following terms:</p>

<ul>
<li>ensemble</li>
<li>peer</li>
<li>leader</li>
<li>follower</li>
<li>worker</li>
<li>integrity checking</li>
<li>Merkle tree</li>
</ul>

<p>For an explanation of these terms, see the [[Implementation
Details|Managing Strong Consistency#Implementation-Details]] section
above.</p>

<h4 id="leader-behavior:12852f79e49b73416cfd63bb30fc96d8">Leader Behavior</h4>

<p>The <code>trust_lease</code> setting determines whether leader leases are used to
optimize reads. When set to <code>true</code>, a leader with a valid lease can
handle reads directly without needing to contact any followers. When
<code>false</code>, the leader will always contact followers, which can lead to
degraded read performance. The default is <code>true</code>. We recommend leaving
leader leases enabled for performance reasons.</p>

<p>All leaders have periodic duties that they perform, including refreshing
the leader lease. You can determine how frequently this occurs, in
milliseconds, using the <code>ensemble_tick</code> setting. The default is 500
milliseconds. Please note that this setting must be lower than both
the <code>lease_duration</code> and <code>follower_timeout</code> settings (both explained
below).</p>

<p>If you set <code>trust_lease</code> to <code>true</code>, you can also specify how long a
leader lease remains valid without being refreshed using the
<code>lease_duration</code> setting, which is specified in milliseconds. This
setting should be higher than <code>ensemble_tick</code> to ensure that leaders
have to time to refresh their leases before they time out, and it <em>must</em>
be lower than <code>follower_timeout</code>, explained in the section below. The
default is <code>ensemble_tick</code> * <sup>3</sup>&frasl;<sub>2</sub>, i.e. if <code>ensemble_tick</code> is 400,
<code>lease_duration</code> will default to 600.</p>

<h4 id="worker-settings:12852f79e49b73416cfd63bb30fc96d8">Worker Settings</h4>

<p>You can choose how many workers are assigned to each peer using the
<code>peer_workers</code> setting. Workers are lightweight processes spawned by
leaders and followers. While increasing the number of workers will make
the strong consistency subsystem slightly more computationally
expensive, more workers can mean improved performance in some cases,
depending on the workload. The default is 1.</p>

<h3 id="timeouts:12852f79e49b73416cfd63bb30fc96d8">Timeouts</h3>

<p>You can establish timeouts for both reads and writes (puts and deletes)
using the <code>peer_get_timeout</code> and <code>peer_put_timeout</code> settings,
respectively. Both are expressed in milliseconds and default to 60000
(1 minute).</p>

<p>Longer timeouts will decrease the likelihood that read or write
operations will fail due to long computation times; shorter timeouts
entail shorter wait times for connecting clients, but at a higher risk
of failed operations under heavy load.</p>

<h3 id="merkle-tree-settings:12852f79e49b73416cfd63bb30fc96d8">Merkle Tree Settings</h3>

<p><a name="merkle"></a></p>

<p>Leaders and followers in Riak&rsquo;s strong consistency system maintain
persistent <a href="http://en.wikipedia.org/wiki/Merkle_tree">Merkle trees</a> for
all data stored by that peer. More information can be found in the
<strong>Integrity Checking</strong> section above. The two sections directly below
describe Merkle-tree-related parameters.</p>

<h4 id="tree-validation:12852f79e49b73416cfd63bb30fc96d8">Tree Validation</h4>

<p>The <code>tree_validation</code> parameter determines whether Riak considers Merkle
trees to be trusted after peers are restarted (for whatever reason).
When enabled, i.e. when <code>tree_validation</code> is set to <code>true</code> (the
default), Riak does not trust peer trees after a restart, instead
requiring the peer to sync with a trusted quorum. While this is the
safest mode because it protects Riak against silent corruption in Merkle
trees, it carries the drawback that it can reduce Riak availability by
requiring more than a simple majority of nodes to be online and
reachable when peers restart.</p>

<p>If you are using ensembles with N=3, we strongly recommend setting
<code>tree_validation</code> to <code>false</code>.</p>

<h4 id="synchronous-vs-asynchronous-tree-updates:12852f79e49b73416cfd63bb30fc96d8">Synchronous vs. Asynchronous Tree Updates</h4>

<p>Merkle tree updates can happen synchronously or asynchronously. This is
determined by the <code>synchronous_tree_updates</code> parameter. When set to
<code>false</code>, which is the default, Riak responds to the client after the
first roundtrip that updates the followers&rsquo; data but before the second
roundtrip required to update the followers&rsquo; Merkle trees, allowing the
Merkle tree update to happen asynchronously in the background; when set
to <code>true</code>, Riak requires two quorum roundtrips to occur before replying
back to the client, which can increase per-request latency.</p>

<p>Please note that this setting applies only to Merkle tree updates sent
to followers. Leaders <em>always</em> update their local Merkle trees before
responding to the client. Asynchronous updates can be unsafe in certain
scenarios. For example, if a leader crashes before sending metadata
updates to followers <em>and</em> all followers that had acknowledged the write
somehow revert the object value immediately prior to the write request,
a future read could hypothetically return the immediately preceding
value without realizing that the value was incorrect. Setting
<code>synchronous_tree_updates</code> to <code>false</code> does bear this possibility, but it
is highly unlikely.</p>

<h2 id="strong-consistency-and-active-anti-entropy:12852f79e49b73416cfd63bb30fc96d8">Strong Consistency and Active Anti-Entropy</h2>

<p>Riak&rsquo;s [[active anti-entropy]] (AAE) feature <em>can</em> repair strongly
consistent data. Although it is not necessary to use active anti-entropy
if you are using strong consistency, we nonetheless recommend doing so.</p>

<p>Without AAE, all object conflicts are repaired via [[read
repair|Active Anti-Entropy#Read-Repair-vs.-Active-Anti-Entropy]].
Read repair, however, cannot repair conflicts in so-called &ldquo;cold data,&rdquo;
i.e. data that may not be read for long periods of time. While using AAE
does entail small performance losses, not using AAE can lead to problems
with silent on-disk corruption.</p>

<p>To avoid these problems, you should [[enable active anti-entropy|Managing
Active Anti-Entropy##Enabling-Active-Anti-Entropy]] in your cluster.</p>

<h2 id="strong-consistency-and-bitcask:12852f79e49b73416cfd63bb30fc96d8">Strong Consistency and Bitcask</h2>

<p>One feature that is offered by Riak&rsquo;s optional <a href="/riak/kv/2.1.3/setup/planning/backend/bitcask">Bitcask</a> backend is
[[object expiry|Bitcask#Configuring-Bitcask]]. If you are using strong
consistency and Bitcask together, you should be aware that object
metadata is often updated by the strong consistency subsystem during
leader changes, which typically take place when nodes go down or during
network partitions. When these metadata updates take place, the time to
live (TTL) of the object is refreshed, which can lead to general
unpredictably in objects&rsquo; TTL. Although leader changes will be rare in
many clusters, we nonetheless recommend that you use object expiry in
strongly consistent buckets only in situations when these occasional
irregularities are acceptable.</p>

<h2 id="important-caveats:12852f79e49b73416cfd63bb30fc96d8">Important Caveats</h2>

<p>The following Riak features are not currently available in strongly
consistent buckets:</p>

<ul>
<li>[[Secondary indexes|Using Secondary Indexes]] &mdash; If you do attach
secondary index metadata to objects in strongly consistent buckets,
strongly consistent operations can still proceed, but that metadata
will be silently ignored.</li>
<li>[[Riak Data Types|Using Data Types]] &mdash; Data Types can currently be
used only in an eventually consistent fashion</li>
<li>[[Using commit hooks]] &mdash; Neither pre- nor post-commit hooks are
supported in strongly consistent buckets. If you do associate a
strongly consistent bucket with one or more commit hooks, strongly
consistent operations can proceed as normal in that bucket, but all
commit hooks will be silently ignored.</li>
</ul>

<p>Furthermore, you should also be aware that strong consistency guarantees
are applied only at the level of single keys. There is currently no
support within Riak for strongly consistent operations against multiple
keys, although it is always possible to incorporate client-side write
and read locks in applications that use strong consistency.</p>

<h2 id="known-issues:12852f79e49b73416cfd63bb30fc96d8">Known Issues</h2>

<p>There are a few known issues that you should be aware of when using the
latest version of strong consistency.</p>

<ul>
<li><strong>Consistent reads of never-written keys create tombstones</strong> &mdash; A
[[tombstone|Object Deletion]] will be written if you perform a read
against a key that a majority of peers claims to not exist. This is
necessary for certain corner cases in which offline or unreachable
replicas containing partially written data need to be rolled back in
the future.</li>
<li><strong>Consistent keys and key listing</strong> &mdash; In Riak, key listing
operations, such as listing all the keys in a bucket, do not filter
out tombstones. While this is rarely a problem for
non-strongly-consistent keys, it does present an issue for strong
consistency due to the tombstone issues mentioned above.</li>
<li><strong>Secondary indexes not supported</strong> &mdash; Strongly consistent
operations do not support [[secondary indexes|Using Strong
Consistency]] (2i) at this time. Furthermore, any other metadata
attached to objects, even if not related to 2i, will be silently
ignored by Riak in strongly consistent buckets.</li>
<li><strong>Multi-Datacenter Replication not supported</strong> &mdash; At this time,
consistent keys are <em>not</em> replicated across clusters using [[Multi-
Datacenter Replication|Multi Data Center Replication: Architecture]]
(MDC). This is because MDC Replication currently supports only
eventually consistent replication across clusters. Mixing strongly
consistent data within a cluster with eventually consistent data
between clusters is difficult to reason about from the perspective of
applications. In a future version of Riak, we will add support for
strongly consistent replication across multiple datacenters/clusters.</li>
<li><strong>Client library exceptions</strong> &mdash; Basho&rsquo;s official [[client
libraries]] convert errors returned by Riak into generic exceptions,
with a message derived from the returned server-side error message.
More information on this problem can be found in [[Using Strong
Consistency|Using Strong Consistency#Error-Messages]].</li>
</ul>


      <div class="clear"></div>

    </article>

    <footer class="mastfooter">
    This work is licensed under a
    <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
        Creative Commons Attribution 4.0 International Public License
    </a><br>
    &copy; 2011-2016&nbsp;<a href="http://www.basho.com">Basho Technologies, Inc.</a>
</footer>


  </div>

  <script src="/js/all.js" type="text/javascript"></script>
<script type= "text/javascript">
  
  hljs.configure({languages: []});
  hljs.initHighlighting();

  
  
  
  $(function() {
    $(".js_enabled pre").css("visibility", "visible");
  });
</script>


</body>
</html>
