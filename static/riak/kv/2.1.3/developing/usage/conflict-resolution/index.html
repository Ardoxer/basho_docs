<!DOCTYPE html>

<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"></html><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"></html><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"></html><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->




<head class="tutorials">
  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width">
  <meta name="project" content="riak_kv">
  <meta name="version" content="2.1.3">
  <meta name="base-url" content="">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  <title>Conflict Resolution</title>

  <link href="/css/all.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/css/print.css" media="print" rel="stylesheet" type="text/css">

  
  <style type="text/css"> .js_enabled pre { visibility : hidden; } </style>
  <script type="text/javascript">
    document.documentElement.className = 'js_enabled';
  </script>
</head>



<body class="riak_kv 2.1.3 latest ">

  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-T9C8MK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-T9C8MK');</script>

  
<aside id="nav-container" role="complementary">
  <nav class="overview" id="primary-nav" role="nav">
    <div id="primary-nav-content">
      <h2 class="responsive-link"><a class="responsive-toggle"></a></h2>

      
      <form id="searchbox_011972015458788978446:zgdcy4fa-o0" action="">
        <div class="nav-field-container">
          <div id="icon-container-search">
            <div class="icon-container"><span aria-hidden="true" class="nav-icon-search icon-search"></span></div>
            <span class="separator">&#124;</span>
          </div>
          <input id="main-search" name="q" placeholder="Search" size="5" type="search" />
        </div>
      </form>

      <div class="clear"></div>

      
      <h3 class="responsive-link visit-basho">
        <a href="http://www.basho.com">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">Visit Basho</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      <h3 class="responsive-link">
        <a href="/index.html">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">All Riak Projects</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-riak"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/">Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-download-alt"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/downloads/">Download Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-install"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/setup/">Setup</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/">Planning</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/start/">Start Planning</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/operating-system/">OS Support</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/backend/">Choosing a Backend</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/bitcask/">Bitcask</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/leveldb/">LevelDB</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/memory/">Memory</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/multi/">Multi-backend</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/cluster-capacity/">Cluster Capacity</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/bitcask-capacity-calc/">Bitcask Capacity Calculator</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/future/">Planning for the Future</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/">Installing</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/amazon-web-services/">Amazon Web Services</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/debian-ubuntu/">Debian &amp; Ubuntu</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/freebsd/">FreeBSD</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/mac-osx/">Mac OS X</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/rhel-centos/">RHEL &amp; CentOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/smartos/">SmartOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/solaris/">Solaris</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/suse/">SUSE</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/windows-azure/">Windows Azure</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/source/">Installing From Source</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/erlang/">Installing Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/jvm/">Installing the JVM</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/verify/">Verifying an Installation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/upgrading/">Upgrading</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/checklist/">Production Checklist</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/version/">Upgrading by Version</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/cluster/">Upgrading a Cluster</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/multi-datacenter/">Upgrading Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/downgrade/">Downgrading</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-cog"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/configuring/">Configuring</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/basic/">Basic Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/backend/">Backend Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/managing/">Managing Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/reference/">Configuration Reference</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/strong-consistency/">Implementing Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/load-balancing-proxy/">Load Balancing &amp; Proxy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/mapreduce/">MapReduce Settings</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/search/">Search Settings</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/">V3 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/">V2 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-database"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/using/">Using</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/running-a-cluster/">Running a Cluster</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/admin/">Cluster Administration</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/commands/">Cluster Admin Commands</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-admin/">riak-admin CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-cli/">riak CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-control/">Riak Control</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/cluster-operations/">Cluster Operations</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/adding-removing-nodes/">Adding/Removing Nodes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/changing-cluster-info/">Changing Cluster Information</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/replacing-node/">Replacing a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/inspecting-node/">Inspecting a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backing-up/">Backing Up</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/secondary-indexes/">Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/monitoring-strong-consistency/">Monitoring Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/load-balancing/">Load Balancing</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backend/">Backend</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v3-multi-datacenter/">V3 Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v2-multi-datacenter/">V2 Multi-Datacenter</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/repair-recovery/">Repair &amp; Recovery</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/errors/">Errors</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/repairs/">Repairs</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/rolling-restart/">Rolling Restarts</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/security/">Security</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/basics/">Security Basics</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/managing-sources/">Managing Security Sources</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/v2-v3-ssl-ca/">V2/V3 SSL &amp; CA Validation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/performance/">Performance</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/benchmarking/">Benchmarking</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/open-files-limit/">Open Files Limit</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/v2-scheduling-fullsync/">V2 Scheduling Fullsync</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/multi-datacenter-tuning/">Multi-Datacenter Replication</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/">Troubleshooting</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/">Product Advisories</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/210-dataloss/">Default Configuration For Handoff May Cause Data Loss</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/appconfig-foward/">Forward Incompatibility of app.config</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/dvv-lastwritewins/">Incompatibility between Dotted Version Vectors and Last Write Wins</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/maps-204/">Map Data Type Disk Incompatibility</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/ssl-poodle/">SSL 3.0 Vulnerability and POODLE Attack</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/http-204/">HTTP 204</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/reference/">Reference</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/runtime-interaction/">Runtime Interaction</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/monitoring/">Monitoring</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/search-secondary-indexes/">Search &amp; Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/multi-datacenter/">Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v3/">V3 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v2/">V2 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/architecture/">Architecture</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-lambda"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/developing/">Developing</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/">Getting Started</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/java/">Java</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/ruby/">Ruby</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/python/">Python</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/csharp/">C Sharp</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/nodejs/">NodeJS</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/erlang/">Erlang</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/golang/">Go</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/php/">PHP</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/querying/">Querying</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/">Usage</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/creating-objects/">Creating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/reading-objects/">Reading Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/updating-objects/">Updating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/deleting-objects/">Deleting Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/content-types/">Content Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search/">Searching</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/mapreduce/">Using MapReduce</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/secondary-indexes/">Using Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/commit-hooks/">Using Commit Hooks</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search-schemas/">Creating Search Schemas</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/searching-data-types/">Searching with Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/document-store/">Implementing a Document Store</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/custom-extractors/">Custom Extractors</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/security/">Security</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/erlang/">Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/php/">PHP</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/replication/">Replication</a>
  
  </li>
  <li class="current">
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/">Conflict Resolution</a></span></h4>
    
<ul class="depth-3" style="display: block;">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/csharp/">C Sharp</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/nodejs/">NodeJS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/php/">PHP</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/golang/">Go</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-types/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-modeling/">Data Modeling</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/app-guide/">Application Guide</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/replication-properties/">Replication Properties</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/write-once/">Write Once</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/reference/">Reference</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/client-libraries/">Client Libraries</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/api/">APIs</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/repl-hooks/">V2 Multi-Datacenter REPL Hooks API</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/backend/">Backend API</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/faq/">Developing FAQ</a>
  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-beaker"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/learn/">Learning</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/why-riak-kv/">Why Riak KV?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/use-cases/">Use Cases</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/new-to-nosql/">New to NoSQL?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/glossary/">Riak KV Glossary</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/learn/concepts/">Concepts</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/active-anti-entropy/">Active Anti-Entropy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/buckets/">Buckets</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/capability-negotiation/">Capability Negotiation</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/causal-context/">Causal Context</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/clusters/">Clusters</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/crdts/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/eventual-consistency/">Eventual Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/keys-and-objects/">Keys and Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/replication/">Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/vnodes/">Vnodes</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-comments"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/community">Community</a></span>
        <div class="clear"></div>
      </h3>
      <ul></ul> 
    </div>
  </nav>

  
  <ul id="fixed-nav">
    <li>
      <a href="https://github.com/basho/basho_docs" target="_blank">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xe004;"></span>
        </div>
        <span class="separator">&#124;</span>Available on GitHub
      </a>
    </li>
    <li>
      <a href="/riak/latest/community/">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xf059;"></span>
        </div>
        <span class="separator">&#124;</span>Get Help
      </a>
    </li>
  </ul>
</aside>


  <script>
  (function() {
    var cx = '011972015458788978446:zgdcy4fa-o0';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:0px;overflow:hidden;height:0px;">
  <gcse:search></gcse:search>
</div>


  <div role="main">

    <header class="masthead">
  <div id="header">
    
    <div id="header-inner">
      <div class="icon-reorder" id="nav-toggle"></div>

      <div id="top-nav">
        
        <a href="/riak/kv/2.1.3/downloads/"><span class="icon-download-alt"></span>Downloads</a>
        <div id="nav-more"><span class="icon-more"></span></div>
      </div>

      <a class="responsive-toggle"></a>
      
      
      <a class="logo" href="/index.html"><h1>Riak Docs</h1></a>
      
      <span class="tagline">Product tutorials, how-tos, and fully-documented APIs.</span>
      <div id="nav-menu">
        <h2>Links</h2>
        <ul>
          <li><a href="http://docs.basho.com/">Docs Home</a></li>
          <li><a href="http://basho.com/">Basho Website</a></li>
        </ul>
        
        <div id="nav-menu-arrow"></div>
        <div id="nav-menu-arrow-back"></div>
      </div>

      <div class="clear"></div>

      <div class="header-rule"></div>
    </div>
  </div>
</header>


    <article class="mainarticle">

      <div class="versions">
  <div id="version-ddown-button" class="unselected">
    <div class="version-ddown-title">Version</div>
    <div class="version-ddown-number">2.1.3</div>
    <div class="version-ddown-arrow"></div>
  </div>
  <ol id="version-list" style="display: none;">
  
  
    
    
      
      
      <li class="sans versions-0 current">DEV</li>
      
      <li class="current versions-0"><a class="versioned" href="/riak/kv/2.1.3/developing/usage/conflict-resolution/">2.1.3</a></li>
    
    
      
      
      
      <li class=" versions-0 first"><a class="versioned" href="/riak/kv/2.1.1/developing/usage/conflict-resolution/">2.1.1</a></li>
    
  
    
    
      
      
      
      <li class="sans versions-1 current">LTS</li>
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.6/developing/usage/conflict-resolution/">2.0.6</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.5/developing/usage/conflict-resolution/">2.0.5</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.4/developing/usage/conflict-resolution/">2.0.4</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.2/developing/usage/conflict-resolution/">2.0.2</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.1/developing/usage/conflict-resolution/">2.0.1</a></li>
    
    
      
      
      
      <li class=" versions-1 first"><a class="versioned" href="/riak/kv/2.0.0/developing/usage/conflict-resolution/">2.0.0</a></li>
    
  
  
  <li class="versions-5 first"><a class="sans versioned" href="http://docs.basho.com/riak/1.4.12/">older</a></li>
  </ol>
</div>


      
      

      <header><h1>Conflict Resolution</h1></header>

      

      
      <nav id="toc">
        <h2 class="title">Contents</h2>
        <div id="toc-wrapper">
          <ol id="toc-items"></ol>
        </div>
      </nav>
      

      

<p>One of Riak&rsquo;s [[central goals|Why Riak]] is high availability. It was
built as a [[clustered|Clusters]] system in which any [[node|Riak
Glossary#Node]] is capable of receiving requests without requiring that
every node participate in each request.</p>

<p>If you are using Riak in an [[eventually consistent|Eventual
Consistency]] way, conflicts between object values on different nodes is
unavoidable. Often, Riak can resolve these conflicts on its own
internally if you use causal context, i.e. [[vector clocks|Causal
Context#Vector-Clocks]] or [[dotted version vectors|Causal
Context#Dotted-Version-Vectors]], when updating objects. Instructions
on this can be found in the section [[below|Conflict
Resolution#Siblings]].</p>

<div class="note">
<div class="title">Important note on terminology</div>
In versions of Riak prior to 2.0, vector clocks were the only causal
context mechanism available in Riak, which changed with the introduction
of dotted version vectors in 2.0. Please note that you may frequent find
terminology in client library APIs, internal Basho documentation, and
more that uses the term "vector clock" interchangeably with causal
context in general. Riak's HTTP API still uses a `X-Riak-Vclock` header,
for example, even if you are using dotted version vectors.
</div>

<p>But even when you use causal context, Riak cannot always decide which
value is most causally recent, especially in cases involving concurrent
updates to an object. So how does Riak behave when it can&rsquo;t decide on a
single most-up-to-date value? <strong>That is your choice</strong>. A full listing of
available options can be found in the [[section below|Conflict
Resolution#Client-and-Server-side-Conflict-Resolution]]. For now,
though, please bear in mind that we strongly recommend one of the
following two options:</p>

<ol>
<li>If your data can be modeled as one of the currently available [[Riak
Data Types|Data Types]], we recommend using one of these types,
because all of them have conflict resolution <em>built in</em>, completely
relieving applications of the need to engage in conflict resolution.</li>
<li>If your data cannot be modeled as one of the available Data Types,
we recommend allowing Riak to generate [[siblings|Conflict
Resolution#Siblings]] and to design your application to resolve
conflicts in a way that fits your use case. Developing your own
<strong>conflict resolution strategy</strong> can be tricky, but it has clear
advantages over other approaches.</li>
</ol>

<p>Because Riak allows for a mixed approach when storing and managing data,
you can apply multiple conflict resolution strategies within a cluster.</p>

<div class="note">
<div class="title">Note on strong consistency</div>
In versions of Riak 2.0 and later, you have the option of using Riak in
a strongly consistent fashion. This document pertains to usage of Riak
as an <em>eventually</em> consistent system. If you'd like to use Riak's
strong consistency feature, please refer to the following documents:

* [[Using Strong Consistency]] --- A guide for developers<br />
* [[Managing Strong Consistency]] --- A guide for operators<br />
* [[Strong Consistency]] --- A more theoretical explication of strong
  consistency
</div>

<h2 id="client-and-server-side-conflict-resolution:d680e8a854a7cbad6d490c445cba2eba">Client- and Server-side Conflict Resolution</h2>

<p>Riak&rsquo;s eventual consistency model is powerful because Riak is
fundamentally non-opinionated about how data resolution takes place.
While Riak <em>does</em> have a set of [[defaults|Replication
Properties#available-parameters]], there are a variety of general
approaches to conflict resolution that are available. In Riak, you can
mix and match conflict resolution strategies at the bucket level,
[[using bucket types]]. The most important [[bucket properties|Buckets]]
to consider when reasoning about conflict resolution are the
<code>allow_mult</code> and <code>last_write_wins</code> properties.</p>

<p>These properties provide you with the following basic options:</p>

<h3 id="timestamp-based-resolution:d680e8a854a7cbad6d490c445cba2eba">Timestamp-based Resolution</h3>

<p>If the <code>[[allow_mult|Conflict Resolution#siblings]]</code> parameter is set to
<code>false</code>, Riak resolves all object replica conflicts internally and does
not return siblings to the client. How Riak resolves those conflicts
depends on the value that you set for a different bucket property,
<code>[[last_write_wins|Buckets]]</code>. If <code>last_write_wins</code> is set to <code>false</code>,
Riak will resolve all conflicts on the basis of
<a href="http://en.wikipedia.org/wiki/Timestamp">timestamps</a>, which are
attached to all Riak objects as metadata.</p>

<p>The problem with timestamps is that they are not a reliable resolution
mechanism in distributed systems, and they always bear the risk of data
loss. A better yet still-problematic option is to adopt a
last-write-wins strategy, described directly below.</p>

<h3 id="last-write-wins:d680e8a854a7cbad6d490c445cba2eba">Last-write-wins</h3>

<p>Another way to manage conflicts is to set <code>allow_mult</code> to <code>false</code>, as
with timestamp-based resolution, while also setting the
<code>[[last_write_wins|Conflict Resolution#last-write-wins]]</code> parameter to
<code>true</code>. This produces a so-called last-write-wins (LWW) strategy whereby
Riak foregoes the use of all internal conflict resolution strategies
when making writes, effectively disregarding all previous writes.</p>

<p>The problem with LWW is that it will necessarily drop some writes in the
case of concurrent updates in the name of preventing sibling creation.
If your use case requires that your application be able to reason about
differing values produced in the case of concurrent updates, then we
advise against LWW as a general conflict resolution strategy.</p>

<p>However, LWW can be useful&mdash;and safe&mdash;if you are certain that there
will be no concurrent updates. If you are storing immutable data in
which each object is guaranteed to have its own key or engaging in
operations related to bulk loading, you should consider LWW.</p>

<div class="note">
<div class="title">Undefined behavior warning</div>
Setting both <code>allow_mult</code> and <code>last_write_wins</code> to
<code>true</code> necessarily leads to unpredictable behavior and should
always be avoided.
</div>

<h3 id="resolve-conflicts-on-the-application-side:d680e8a854a7cbad6d490c445cba2eba">Resolve Conflicts on the Application Side</h3>

<p>While setting <code>allow_mult</code> to <code>false</code> unburdens applications from having
to reason about siblings, delegating that responsibility to Riak itself,
it bears all of the drawbacks explained above. On the other hand,
setting <code>allow_mult</code> to <code>true</code> has the following benefits:</p>

<ul>
<li>Riak will retain writes even in the case of concurrent updates to a
key, which enables you to capture the benefits of high availability
with a far lower risk of data loss</li>
<li>If your application encounters siblings, it can apply its own
use-case-specific conflict resolution logic</li>
</ul>

<p>Conflict resolution in Riak can be a complex business, but the presence
of this variety of options means that requests to Riak can always be
made in accordance with your data model(s), business needs, and use
cases. For examples of client-side sibling resolution, see the following
client-library-specific docs:</p>

<ul>
<li>[[Java|Conflict Resolution: Java]]</li>
<li>[[Ruby|Conflict Resolution: Ruby]]</li>
<li>[[Python|Conflict Resolution: Python]]</li>
<li>[[C#|Conflict Resolution: CSharp]]</li>
<li>[[Node.js|Conflict Resolution: NodeJS]]</li>
</ul>

<p>In Riak versions 2.0 and later, <code>allow_mult</code> is set to <code>true</code> by default
for any [[bucket types|Using Bucket Types]] that you create. This means
that if you wish to avoid client-side sibling resolution, you have a few
options:</p>

<ul>
<li>Explicitly create and activate [[bucket types|Using Bucket Types]]
that set <code>allow_mult</code> to <code>false</code></li>
<li>Use Riak&rsquo;s [[configuration files]] to change the [[default bucket
properties|Configuration Files#Default-Bucket-Properties]] for your
cluster. If you set the <code>buckets.default.allow_mult</code> parameter to
<code>false</code>, all bucket types that you create will have <code>allow_mult</code> set
to <code>false</code> by default.</li>
</ul>

<h2 id="causal-context:d680e8a854a7cbad6d490c445cba2eba">Causal Context</h2>

<p>When a value is stored in Riak, it is tagged with a piece of metadata
called a <strong>causal context</strong> which establishes the object&rsquo;s initial
version. Causal context comes in one of two possible forms, depending
on what value you set for <code>dvv_enabled</code>. If set to <code>true</code>, [[dotted
version vectors|Causal Context#Dotted-Version-Vectors]] will be used; if
set to <code>false</code> (the default), [[vector clocks|Causal
Context#Vector-Clocks]] will be used.</p>

<p>Causal context essentially enables Riak to compare the different values
of objects stored in Riak and to determine a number of important things
about those values:</p>

<ul>
<li>Whether one value is a direct descendant of the other</li>
<li>Whether the values are direct descendants of a common parent</li>
<li>Whether the values are unrelated in recent heritage</li>
</ul>

<p>Using the information provided by causal context, Riak is frequently,
though not always, able to resolve conflicts between values without
producing siblings.</p>

<p>Both vector clocks and dotted version vectors are non human readable and
look something like this:</p>

<pre><code>a85hYGBgzGDKBVIcR4M2cgczH7HPYEpkzGNlsP/VfYYvCwA=
</code></pre>

<p>If <code>allow_mult</code> is set to <code>true</code>, you should <em>always</em> use causal context
when updating objects, <em>unless you are certain that no object exists
under that key</em>. Failing to use causal context with mutable data,
especially for objects that are frequently updated, can lead to
[[sibling explosion|Latency Reduction Checklist#Siblings]], which can
produce a variety of problems in your cluster. Fortunately, much of the
work involved with using causal context is handled automatically by
Basho&rsquo;s official [[client libraries]]. Examples can be found for each
client library in the [[Object Updates]] document.</p>

<h2 id="siblings:d680e8a854a7cbad6d490c445cba2eba">Siblings</h2>

<p>A <strong>sibling</strong> is created when Riak is unable to resolve the canonical
version of an object being stored, i.e. when Riak is presented with
multiple possible values for an object and can&rsquo;t figure out which one is
most causally recent. The following scenarios can create sibling values
inside of a single object:</p>

<ol>
<li><strong>Concurrent writes</strong> &mdash; If two writes occur simultaneously from
clients, Riak may not be able to choose a single value to store, in
which case the object will be given a sibling. These writes could happen
on the same node or on different nodes.</li>
<li><strong>Stale causal context</strong> &mdash; Writes from any client using a stale
[[causal context]]. This is a less likely scenario if a client updates
the object by reading the object first, fetching the causal context
currently attached to the object, and then returning that causal context
to Riak when performing the update (fortunately, our client libraries
handle much of this automatically). However, even if a client follows
this protocol when performing updates, a situation may occur in which an
update happens from a different client while the read/write cycle is
taking place. This may cause the first client to issue the write with an
old causal context value and for a sibling to be created. A client is
&ldquo;misbehaved&rdquo; if it habitually updates objects with a stale or no context
object.</li>
<li><strong>Missing causal context</strong> &mdash; If an object is updated with no causal
context attached, siblings are very likely to be created. This is an
unlikely scenario if you&rsquo;re using a Basho client library, but it <em>can</em>
happen if you are manipulating objects using a client like <code>curl</code> and
forgetting to set the <code>X-Riak-Vclock</code> header.</li>
</ol>

<h2 id="siblings-in-action:d680e8a854a7cbad6d490c445cba2eba">Siblings in Action</h2>

<p>Let&rsquo;s have a more concrete look at how siblings work in Riak. First,
we&rsquo;ll create a bucket type called <code>siblings_allowed</code> with <code>allow_mult</code>
set to <code>true</code>:</p>

<pre><code class="language-bash">riak-admin bucket-type create siblings_allowed '{&quot;props&quot;:{&quot;allow_mult&quot;:true}}'
riak-admin bucket-type activate siblings_allowed
riak-admin bucket-type status siblings_allowed
</code></pre>

<p>If the type has been activated, running the <code>status</code> command should
return <code>siblings_allowed is active</code>. Now, we&rsquo;ll create two objects and
write both of them to the same key without first fetching the object
(which obtains the causal context):</p>

<pre><code class="language-java">Location bestCharacterKey =
  new Location(new Namespace(&quot;siblings_allowed&quot;, &quot;nickolodeon&quot;), &quot;best_character&quot;);

RiakObject obj1 = new RiakObject()
        .withContentType(&quot;text/plain&quot;)
        .withValue(BinaryValue.create(&quot;Ren&quot;));
RiakObject obj2 = new RiakObject()
        .withContentType(&quot;text/plain&quot;)
        .withValue(BinaryValue.create(&quot;Stimpy&quot;));
StoreValue store1 = new StoreValue.Builder(obj1)
        .withLocation(bestCharacterKey)
        .build();
StoreValue store2 = new StoreValue.Builder(obj2)
        .withLocation(bestCharacterKey)
        .build();
client.execute(store1);
client.execute(store2);
</code></pre>

<pre><code class="language-ruby">bucket = client.bucket_type('siblings_allowed').bucket('nickolodeon')
obj1 = Riak::RObject.new(bucket, 'best_character')
obj1.content_type = 'text/plain'
obj1.raw_data = 'Ren'
obj1.store

obj2 = Riak::RObject.new(bucket, 'best_character')
obj2.content_type = 'text/plain'
obj2.raw_data = 'Stimpy'
obj2.store
</code></pre>

<pre><code class="language-python">bucket = client.bucket_type('siblings_allowed').bucket('nickolodeon')
obj1 = RiakObject(client, bucket, 'best_character')
obj1.content_type = 'text/plain'
obj1.data = 'Ren'
obj1.store()

obj2 = RiakObject(client, bucket, 'best_character')
obj2.content_type = 'text/plain'
obj2.data = 'Stimpy'
obj2.store()
</code></pre>

<pre><code class="language-csharp">var id = new RiakObjectId(&quot;siblings_allowed&quot;, &quot;nickolodeon&quot;, &quot;best_character&quot;);

var renObj = new RiakObject(id, &quot;Ren&quot;, RiakConstants.ContentTypes.TextPlain);
var stimpyObj = new RiakObject(id, &quot;Stimpy&quot;, RiakConstants.ContentTypes.TextPlain);

var renResult = client.Put(renObj);
var stimpyResult = client.Put(stimpyObj);
</code></pre>

<pre><code class="language-javascript">var obj1 = new Riak.Commands.KV.RiakObject();
obj1.setContentType('text/plain');
obj1.setBucketType('siblings_allowed');
obj1.setBucket('nickolodeon');
obj1.setKey('best_character');
obj1.setValue('Ren');

var obj2 = new Riak.Commands.KV.RiakObject();
obj2.setContentType('text/plain');
obj2.setBucketType('siblings_allowed');
obj2.setBucket('nickolodeon');
obj2.setKey('best_character');
obj2.setValue('Ren');

var storeFuncs = [];
[obj1, obj2].forEach(function (obj) {
    storeFuncs.push(
        function (async_cb) {
            client.storeValue({ value: obj }, function (err, rslt) {
                async_cb(err, rslt);
            });
        }
    );
});

async.parallel(storeFuncs, function (err, rslts) {
    if (err) {
        throw new Error(err);
    }
});
</code></pre>

<pre><code class="language-erlang">Obj1 = riakc_obj:new({&lt;&lt;&quot;siblings_allowed&quot;&gt;&gt;, &lt;&lt;&quot;nickolodeon&quot;&gt;&gt;},
                     &lt;&lt;&quot;best_character&quot;&gt;&gt;,
                     &lt;&lt;&quot;Ren&quot;&gt;&gt;,
                     &lt;&lt;&quot;text/plain&quot;&gt;&gt;),
Obj2 = riakc_obj:new({&lt;&lt;&quot;siblings_allowed&quot;&gt;&gt;, &lt;&lt;&quot;nickolodeon&quot;&gt;&gt;},
                     &lt;&lt;&quot;best_character&quot;&gt;&gt;,
                     &lt;&lt;&quot;Stimpy&quot;&gt;&gt;,
                     &lt;&lt;&quot;text/plain&quot;&gt;&gt;),
riakc_pb_socket:put(Pid, Obj1),
riakc_pb_socket:put(Pid, Obj2).
</code></pre>

<pre><code class="language-curl">curl -XPUT http://localhost:8098/types/siblings_allowed/nickolodeon/whatever/keys/best_character \
  -H &quot;Content-Type: text/plain&quot; \
  -d &quot;Ren&quot;

curl -XPUT http://localhost:8098/types/siblings_allowed/nickolodeon/whatever/keys/best_character \
  -H &quot;Content-Type: text/plain&quot; \
  -d &quot;Stimpy&quot;
</code></pre>

<div class="note">
<div class="title">Getting started with Riak clients</div>
If you are connecting to Riak using one of Basho's official
[[client libraries]], you can find more information about getting
started with your client in our [[quickstart
guide|Five-Minute Install#setting-up-your-riak-client]].
</div>

<p>At this point, multiple objects have been stored in the same key without
passing any causal context to Riak. Let&rsquo;s see what happens if we try to
read contents of the object:</p>

<pre><code class="language-java">Location bestCharacterKey =
  new Location(new Namespace(&quot;siblings_allowed&quot;, &quot;nickolodeon&quot;), &quot;best_character&quot;);

FetchValue fetch = new FetchValue.Builder(bestCharacterKey).build();
FetchValue.Response response = client.execute(fetch);
RiakObject obj = response.getValue(RiakObject.class);
System.out.println(obj.getValue().toString());
</code></pre>

<pre><code class="language-ruby">bucket = client.bucket_type('siblings_allowed').bucket('nickolodeon')
obj = bucket.get('best_character')
obj
</code></pre>

<pre><code class="language-python">bucket = client.bucket_type('siblings_allowed').bucket('nickolodeon')
obj = bucket.get('best_character')
obj.siblings
</code></pre>

<pre><code class="language-csharp">var id = new RiakObjectId(&quot;siblings_allowed&quot;, &quot;nickolodeon&quot;, &quot;best_character&quot;);
var getResult = client.Get(id);
RiakObject obj = getResult.Value;
Debug.WriteLine(format: &quot;Sibling count: {0}&quot;, args: obj.Siblings.Count);
foreach (var sibling in obj.Siblings)
{
    Debug.WriteLine(
        format: &quot;    VTag: {0}&quot;,
        args: sibling.VTag);
}
</code></pre>

<pre><code class="language-javascript">client.fetchValue({
    bucketType: 'siblings_allowed', bucket:
        'nickolodeon', key: 'best_character'
}, function (err, rslt) {
    if (err) {
        throw new Error(err);
    }
    logger.info(&quot;nickolodeon/best_character has '%d' siblings&quot;,
        rslt.values.length);
});
</code></pre>

<pre><code class="language-curl">curl http://localhost:8098/types/siblings_allowed/buckets/nickolodeon/keys/best_character
</code></pre>

<p>Uh-oh! Siblings have been found. We should get this response:</p>

<pre><code class="language-java">com.basho.riak.client.cap.UnresolvedConflictException: Siblings found
</code></pre>

<pre><code class="language-ruby">&lt;Riak::RObject {nickolodeon,best_character} [#&lt;Riak::RContent [text/plain]:&quot;Ren&quot;&gt;, #&lt;Riak::RContent [text/plain]:&quot;Stimpy&quot;&gt;]&gt;
</code></pre>

<pre><code class="language-python">[&lt;riak.content.RiakContent object at 0x10a00eb90&gt;, &lt;riak.content.RiakContent object at 0x10a00ebd0&gt;]
</code></pre>

<pre><code class="language-csharp">Sibling count: 2
    VTag: 1DSVo7VED8AC6llS8IcDE6
    VTag: 7EiwrlFAJI5VMLK87vU4tE
</code></pre>

<pre><code class="language-javascript">info: nickolodeon/best_character has '2' siblings
</code></pre>

<pre><code class="language-curl">Siblings:
175xDv0I3UFCfGRC7K7U9z
6zY2mUCFPEoL834vYCDmPe
</code></pre>

<p>As you can see, reading an object with sibling values will result in
some form of &ldquo;multiple choices&rdquo; response (e.g. <code>300 Multiple Choices</code> in
HTTP). If you&rsquo;re using the HTTP interface and want to view all sibling
values, you can attach an <code>Accept: multipart/mixed</code> header to your
request:</p>

<pre><code class="language-curl">curl -H &quot;Accept: multipart/mixed&quot; \
  http://localhost:8098/types/siblings_allowed/buckets/nickolodeon/keys/best_character
</code></pre>

<p>Response (without headers):</p>

<pre><code>ren
--WUnzXITIPJFwucNwfdaofMkEG7H

stimpy
--WUnzXITIPJFwucNwfdaofMkEG7H--
</code></pre>

<p>If you select the first of the two siblings and retrieve its value, you
should see <code>Ren</code> and not <code>Stimpy</code>.</p>

<h3 id="using-causal-context:d680e8a854a7cbad6d490c445cba2eba">Using Causal Context</h3>

<p>Once you are presented with multiple options for a single value, you
must determine the correct value. In an application, this can be done
either in an automatic fashion, using a use case-specific resolver, or
by presenting the conflicting objects to the end user. For more
information on application-side conflict resolution, see our
client-library-specific documentation for the following languages:</p>

<ul>
<li>[[Java|Conflict Resolution: Java]]</li>
<li>[[Ruby|Conflict Resolution: Ruby]]</li>
<li>[[Python|Conflict Resolution: Python]]</li>
<li>[[C#|Conflict Resolution: CSharp]]</li>
<li>[[Node.js|Conflict Resolution: NodeJS]]</li>
</ul>

<p>We won&rsquo;t deal with conflict resolution in this section. Instead, we&rsquo;ll
focus on how to use causal context.</p>

<p>After having written several objects to Riak in the section above, we
have values in our object: <code>Ren</code> and <code>Stimpy</code>. But let&rsquo;s say that we
decide that <code>Stimpy</code> is the correct value based on our application&rsquo;s use
case. In order to resolve the conflict, we need to do three things:</p>

<ol>
<li>Fetch the current object (which will return both siblings)</li>
<li>Modify the value of the object, i.e. make the value <code>Stimpy</code></li>
<li>Write the object back to the <code>best_character</code> key</li>
</ol>

<p>What happens when we fetch the object first, prior to the update, is
that the object handled by the client has a causal context attached. At
that point, we can modify the object&rsquo;s value, and when we write the
object back to Riak, <em>the causal context will automatically be attached
to it</em>. Let&rsquo;s see what that looks like in practice:</p>

<pre><code class="language-java">// First, we fetch the object
Location bestCharacterKey =
  new Location(new Namespace(&quot;siblings_allowed&quot;, &quot;nickolodeon&quot;), &quot;best_character&quot;);
FetchValue fetch = new FetchValue.Builder(bestCharacterKey).build();
FetchValue.Response res = client.execute(fetch);
RiakObject obj = res.getValue(RiakObject.class);


// Then we modify the object's value
obj.setValue(BinaryValue.create(&quot;Stimpy&quot;));

// Then we store the object, which has the vector clock already attached
StoreValue store = new StoreValue.Builder(obj)
        .withLocation(bestCharacterKey);
client.execute(store);
</code></pre>

<pre><code class="language-ruby"># First, we fetch the object
bucket = client.bucket('nickolodeon')
obj = bucket.get('best_character', type: 'siblings_allowed')

# Then we modify the object's value
obj.raw_data = 'Stimpy'

# Then we store the object, which has the vector clock already attached
obj.store
</code></pre>

<pre><code class="language-python"># First, we fetch the object
bucket = client.bucket_type('siblings_allowed').bucket('nickolodeon')
obj = bucket.get('best_character')

# Then we modify the object's value
new_obj.data = 'Stimpy'

# Then we store the object, which has the vector clock already attached
new_obj.store(vclock=vclock)
</code></pre>

<pre><code class="language-csharp">// First, fetch the object
var getResult = client.Get(id);

// Then, modify the object's value
RiakObject obj = getResult.Value;
obj.SetObject&lt;string&gt;(&quot;Stimpy&quot;, RiakConstants.ContentTypes.TextPlain);

// Then, store the object which has vector clock attached
var putRslt = client.Put(obj);
CheckResult(putRslt);

obj = putRslt.Value;
// Voila, no more siblings!
Debug.Assert(obj.Siblings.Count == 0);
</code></pre>

<pre><code class="language-javascript">client.fetchValue({
        bucketType: 'siblings_allowed',
        bucket: 'nickolodeon',
        key: 'best_character'
    }, function (err, rslt) {
        if (err) {
            throw new Error(err);
        }

        var riakObj = rslt.values.shift();
        riakObj.setValue('Stimpy');
        client.storeValue({ value: riakObj, returnBody: true },
            function (err, rslt) {
                if (err) {
                    throw new Error(err);
                }

                assert(rslt.values.length === 1);
            }
        );
    }
);
</code></pre>

<pre><code class="language-curl">curl -i http://localhost:8098/types/siblings_allowed/buckets/nickolodeon/keys/best_character

# In the HTTP interface, the causal context can be found in the
# &quot;X-Riak-Vclock&quot; header. That will look something like this:

X-Riak-Vclock: a85hYGBgzGDKBVIcR4M2cgczH7HPYEpkzGNlsP/VfYYvCwA=

# When performing a write to the same key, that same header needs to
# accompany the write for Riak to be able to use the vector clock
</code></pre>

<div class="note">
<div class="title">Concurrent conflict resolution</div>
It should be noted that it is possible to have two clients that are
simultaneously engaging in conflict resolution. To avoid a pathological
divergence, you should be sure to limit the number of reconciliations
and fail once that limit has been exceeded.
</div>

<h3 id="sibling-explosion:d680e8a854a7cbad6d490c445cba2eba">Sibling Explosion</h3>

<p>Sibling explosion occurs when an object rapidly collects siblings
without being reconciled. This can lead to myriad issues. Having an
enormous object in your node can cause reads of that object to crash
the entire node. Other issues include [[increased cluster
latency|Latency Reduction Checklist]] as the object is replicated and
out-of-memory errors.</p>

<h3 id="vector-clock-explosion:d680e8a854a7cbad6d490c445cba2eba">Vector Clock Explosion</h3>

<p>Besides sibling explosion, the vector clock itself can grow extremely
large when a significant volume of updates are performed on a single
object in a small period of time. While updating a single object
<em>extremely</em> frequently is not recommended, you can tune Riak&rsquo;s vector
clock pruning to prevent vector clocks from growing too large too
quickly. More on pruning in the [[section below|Conflict
Resolution#vector-clock-pruning]].</p>

<h3 id="how-does-last-write-wins-affect-resolution:d680e8a854a7cbad6d490c445cba2eba">How does <code>last_write_wins</code> affect resolution?</h3>

<p>On the surface, it seems like setting <code>allow_mult</code> to <code>false</code>
(the default) and <code>last_write_wins</code> to <code>true</code> would result in the same
behavior, but there is a subtle distinction.</p>

<p>Even though both settings return only one value to the client, setting
<code>allow_mult</code> to <code>false</code> still uses vector clocks for resolution, whereas
if <code>last_write_wins</code> is <code>true</code>, Riak reads the timestamp to determine
the latest version. Deeper in the system, if <code>allow_mult</code> is <code>false</code>,
Riak will still allow siblings to exist when they are created (via
concurrent writes or network partitions), whereas setting
<code>last_write_wins</code> to <code>true</code> means that Riak will overwrite the value
with the one that has the later timestamp.</p>

<p>When you don&rsquo;t care about sibling creation, setting <code>allow_mult</code> to
<code>false</code> has the least surprising behavior: you get the latest value,
but network partitions are handled gracefully. However, for cases in
which keys are rewritten often (and quickly) and the new value isn&rsquo;t
necessarily dependent on the old value, <code>last_write_wins</code> will provide
better performance. Some use cases where you might want to use
<code>last_write_wins</code> include caching, session storage, and insert-only
(no updates).</p>

<div class="note">
<div class="title">Note on combining <code>allow_mult</code> and
<code>last_write_wins</code></div>
The combination of setting both the <code>allow_mult</code> and
<code>last_write_wins</code> properties to <code>true</code> leads to
undefined behavior and should not be used.
</div>

<h2 id="vector-clock-pruning:d680e8a854a7cbad6d490c445cba2eba">Vector Clock Pruning</h2>

<p>Riak regularly prunes vector clocks to prevent overgrowth based on four
parameters which can be set for any bucket type that you create:</p>

<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>small_vclock</code></td>
<td align="left"><code>50</code></td>
<td align="left">If the length of the vector clock list is smaller than this value, the list&rsquo;s entries will not be pruned</td>
</tr>

<tr>
<td align="left"><code>big_vclock</code></td>
<td align="left"><code>50</code></td>
<td align="left">If the length of the vector clock list is larger than this value, the list will be pruned</td>
</tr>

<tr>
<td align="left"><code>young_vclock</code></td>
<td align="left"><code>20</code></td>
<td align="left">If a vector clock entry is younger than this value (in milliseconds), it will not be pruned</td>
</tr>

<tr>
<td align="left"><code>old_vclock</code></td>
<td align="left"><code>86400</code> (one day)</td>
<td align="left">If a vector clock entry is older than this value (in milliseconds), it will be pruned</td>
</tr>
</tbody>
</table>

<p>This diagram shows how the values of these parameters dictate the vector
clock pruning process:</p>

<p><img src="/images/vclock-pruning.png" alt="Vclock Pruning" /></p>

<h2 id="more-information:d680e8a854a7cbad6d490c445cba2eba">More Information</h2>

<p>Additional background information on vector clocks:</p>

<ul>
<li><a href="http://en.wikipedia.org/wiki/Vector_clock">Vector Clocks on Wikipedia</a></li>
<li><a href="http://basho.com/why-vector-clocks-are-easy/">Why Vector Clocks are Easy</a></li>
<li><a href="http://basho.com/why-vector-clocks-are-hard/">Why Vector Clocks are Hard</a></li>
<li>The vector clocks used in Riak are based on the <a href="http://portal.acm.org/citation.cfm?id=359563">work of Leslie Lamport</a></li>
</ul>


      <div class="clear"></div>

    </article>

    <footer class="mastfooter">
    This work is licensed under a
    <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
        Creative Commons Attribution 4.0 International Public License
    </a><br>
    &copy; 2011-2016&nbsp;<a href="http://www.basho.com">Basho Technologies, Inc.</a>
</footer>


  </div>

  <script src="/js/all.js" type="text/javascript"></script>
<script type= "text/javascript">
  
  hljs.configure({languages: []});
  hljs.initHighlighting();

  
  
  
  $(function() {
    $(".js_enabled pre").css("visibility", "visible");
  });
</script>


</body>
</html>
