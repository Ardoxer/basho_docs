<!DOCTYPE html>

<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"></html><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"></html><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"></html><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->




<head class="tutorials">
  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width">
  <meta name="project" content="riak_kv">
  <meta name="version" content="2.1.3">
  <meta name="base-url" content="">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  <title>Getting Started: Querying with Go</title>

  <link href="/css/all.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/css/print.css" media="print" rel="stylesheet" type="text/css">

  
  <style type="text/css"> .js_enabled pre { visibility : hidden; } </style>
  <script type="text/javascript">
    document.documentElement.className = 'js_enabled';
  </script>
</head>



<body class="riak_kv 2.1.3 latest ">

  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-T9C8MK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-T9C8MK');</script>

  
<aside id="nav-container" role="complementary">
  <nav class="overview" id="primary-nav" role="nav">
    <div id="primary-nav-content">
      <h2 class="responsive-link"><a class="responsive-toggle"></a></h2>

      
      <form id="searchbox_011972015458788978446:zgdcy4fa-o0" action="">
        <div class="nav-field-container">
          <div id="icon-container-search">
            <div class="icon-container"><span aria-hidden="true" class="nav-icon-search icon-search"></span></div>
            <span class="separator">&#124;</span>
          </div>
          <input id="main-search" name="q" placeholder="Search" size="5" type="search" />
        </div>
      </form>

      <div class="clear"></div>

      
      <h3 class="responsive-link visit-basho">
        <a href="http://www.basho.com">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">Visit Basho</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      <h3 class="responsive-link">
        <a href="/index.html">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">All Riak Projects</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-riak"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/">Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-download-alt"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/downloads/">Download Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-install"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/setup/">Setup</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/">Planning</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/start/">Start Planning</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/operating-system/">OS Support</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/backend/">Choosing a Backend</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/bitcask/">Bitcask</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/leveldb/">LevelDB</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/memory/">Memory</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/multi/">Multi-backend</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/cluster-capacity/">Cluster Capacity</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/bitcask-capacity-calc/">Bitcask Capacity Calculator</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/future/">Planning for the Future</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/">Installing</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/amazon-web-services/">Amazon Web Services</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/debian-ubuntu/">Debian &amp; Ubuntu</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/freebsd/">FreeBSD</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/mac-osx/">Mac OS X</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/rhel-centos/">RHEL &amp; CentOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/smartos/">SmartOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/solaris/">Solaris</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/suse/">SUSE</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/windows-azure/">Windows Azure</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/source/">Installing From Source</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/erlang/">Installing Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/jvm/">Installing the JVM</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/verify/">Verifying an Installation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/upgrading/">Upgrading</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/checklist/">Production Checklist</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/version/">Upgrading by Version</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/cluster/">Upgrading a Cluster</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/multi-datacenter/">Upgrading Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/downgrade/">Downgrading</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-cog"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/configuring/">Configuring</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/basic/">Basic Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/backend/">Backend Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/managing/">Managing Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/reference/">Configuration Reference</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/strong-consistency/">Implementing Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/load-balancing-proxy/">Load Balancing &amp; Proxy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/mapreduce/">MapReduce Settings</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/search/">Search Settings</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/">V3 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/">V2 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-database"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/using/">Using</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/running-a-cluster/">Running a Cluster</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/admin/">Cluster Administration</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/commands/">Cluster Admin Commands</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-admin/">riak-admin CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-cli/">riak CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-control/">Riak Control</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/cluster-operations/">Cluster Operations</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/adding-removing-nodes/">Adding/Removing Nodes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/changing-cluster-info/">Changing Cluster Information</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/replacing-node/">Replacing a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/inspecting-node/">Inspecting a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backing-up/">Backing Up</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/secondary-indexes/">Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/monitoring-strong-consistency/">Monitoring Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/load-balancing/">Load Balancing</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backend/">Backend</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v3-multi-datacenter/">V3 Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v2-multi-datacenter/">V2 Multi-Datacenter</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/repair-recovery/">Repair &amp; Recovery</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/errors/">Errors</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/repairs/">Repairs</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/rolling-restart/">Rolling Restarts</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/security/">Security</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/basics/">Security Basics</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/managing-sources/">Managing Security Sources</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/v2-v3-ssl-ca/">V2/V3 SSL &amp; CA Validation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/performance/">Performance</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/benchmarking/">Benchmarking</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/open-files-limit/">Open Files Limit</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/v2-scheduling-fullsync/">V2 Scheduling Fullsync</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/multi-datacenter-tuning/">Multi-Datacenter Replication</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/">Troubleshooting</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/">Product Advisories</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/210-dataloss/">Default Configuration For Handoff May Cause Data Loss</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/appconfig-foward/">Forward Incompatibility of app.config</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/dvv-lastwritewins/">Incompatibility between Dotted Version Vectors and Last Write Wins</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/maps-204/">Map Data Type Disk Incompatibility</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/ssl-poodle/">SSL 3.0 Vulnerability and POODLE Attack</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/http-204/">HTTP 204</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/reference/">Reference</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/runtime-interaction/">Runtime Interaction</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/monitoring/">Monitoring</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/search-secondary-indexes/">Search &amp; Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/multi-datacenter/">Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v3/">V3 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v2/">V2 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/architecture/">Architecture</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-lambda"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/developing/">Developing</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/">Getting Started</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/java/">Java</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/ruby/">Ruby</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/python/">Python</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/csharp/">C Sharp</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/nodejs/">NodeJS</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/erlang/">Erlang</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/golang/">Go</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li class="current">
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/php/">PHP</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/querying/">Querying</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/">Usage</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/creating-objects/">Creating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/reading-objects/">Reading Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/updating-objects/">Updating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/deleting-objects/">Deleting Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/content-types/">Content Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search/">Searching</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/mapreduce/">Using MapReduce</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/secondary-indexes/">Using Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/commit-hooks/">Using Commit Hooks</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search-schemas/">Creating Search Schemas</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/searching-data-types/">Searching with Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/document-store/">Implementing a Document Store</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/custom-extractors/">Custom Extractors</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/security/">Security</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/erlang/">Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/php/">PHP</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/replication/">Replication</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/">Conflict Resolution</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/csharp/">C Sharp</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/nodejs/">NodeJS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/php/">PHP</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/golang/">Go</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-types/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-modeling/">Data Modeling</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/app-guide/">Application Guide</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/replication-properties/">Replication Properties</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/write-once/">Write Once</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/reference/">Reference</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/client-libraries/">Client Libraries</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/api/">APIs</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/repl-hooks/">V2 Multi-Datacenter REPL Hooks API</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/backend/">Backend API</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/faq/">Developing FAQ</a>
  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-beaker"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/learn/">Learning</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/why-riak-kv/">Why Riak KV?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/use-cases/">Use Cases</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/new-to-nosql/">New to NoSQL?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/glossary/">Riak KV Glossary</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/learn/concepts/">Concepts</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/active-anti-entropy/">Active Anti-Entropy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/buckets/">Buckets</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/capability-negotiation/">Capability Negotiation</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/causal-context/">Causal Context</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/clusters/">Clusters</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/crdts/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/eventual-consistency/">Eventual Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/keys-and-objects/">Keys and Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/replication/">Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/vnodes/">Vnodes</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-comments"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/community">Community</a></span>
        <div class="clear"></div>
      </h3>
      <ul></ul> 
    </div>
  </nav>

  
  <ul id="fixed-nav">
    <li>
      <a href="https://github.com/basho/basho_docs" target="_blank">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xe004;"></span>
        </div>
        <span class="separator">&#124;</span>Available on GitHub
      </a>
    </li>
    <li>
      <a href="/riak/latest/community/">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xf059;"></span>
        </div>
        <span class="separator">&#124;</span>Get Help
      </a>
    </li>
  </ul>
</aside>


  <script>
  (function() {
    var cx = '011972015458788978446:zgdcy4fa-o0';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:0px;overflow:hidden;height:0px;">
  <gcse:search></gcse:search>
</div>


  <div role="main">

    <header class="masthead">
  <div id="header">
    
    <div id="header-inner">
      <div class="icon-reorder" id="nav-toggle"></div>

      <div id="top-nav">
        
        <a href="/riak/kv/2.1.3/downloads/"><span class="icon-download-alt"></span>Downloads</a>
        <div id="nav-more"><span class="icon-more"></span></div>
      </div>

      <a class="responsive-toggle"></a>
      
      
      <a class="logo" href="/index.html"><h1>Riak Docs</h1></a>
      
      <span class="tagline">Product tutorials, how-tos, and fully-documented APIs.</span>
      <div id="nav-menu">
        <h2>Links</h2>
        <ul>
          <li><a href="http://docs.basho.com/">Docs Home</a></li>
          <li><a href="http://basho.com/">Basho Website</a></li>
        </ul>
        
        <div id="nav-menu-arrow"></div>
        <div id="nav-menu-arrow-back"></div>
      </div>

      <div class="clear"></div>

      <div class="header-rule"></div>
    </div>
  </div>
</header>


    <article class="mainarticle">

      <div class="versions">
  <div id="version-ddown-button" class="unselected">
    <div class="version-ddown-title">Version</div>
    <div class="version-ddown-number">2.1.3</div>
    <div class="version-ddown-arrow"></div>
  </div>
  <ol id="version-list" style="display: none;">
  
  
    
    
      
      
      <li class="sans versions-0 current">DEV</li>
      
      <li class="current versions-0"><a class="versioned" href="/riak/kv/2.1.3/developing/getting-started/golang/querying/">2.1.3</a></li>
    
    
      
      
      
      <li class=" versions-0 first"><a class="versioned" href="/riak/kv/2.1.1/developing/getting-started/golang/querying/">2.1.1</a></li>
    
  
    
    
      
      
      
      <li class="sans versions-1 current">LTS</li>
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.6/developing/getting-started/golang/querying/">2.0.6</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.5/developing/getting-started/golang/querying/">2.0.5</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.4/developing/getting-started/golang/querying/">2.0.4</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.2/developing/getting-started/golang/querying/">2.0.2</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.1/developing/getting-started/golang/querying/">2.0.1</a></li>
    
    
      
      
      
      <li class=" versions-1 first"><a class="versioned" href="/riak/kv/2.0.0/developing/getting-started/golang/querying/">2.0.0</a></li>
    
  
  
  <li class="versions-5 first"><a class="sans versioned" href="http://docs.basho.com/riak/1.4.12/">older</a></li>
  </ol>
</div>


      
      

      <header><h1>Getting Started: Querying with Go</h1></header>

      

      
      <nav id="toc">
        <h2 class="title">Contents</h2>
        <div id="toc-wrapper">
          <ol id="toc-items"></ol>
        </div>
      </nav>
      

      

<h2 id="go-version-setup:50d269286defa89dcc6793dab2a5c4d0">Go Version Setup</h2>

<p>For the Go version, please download the source from GitHub by either <a href="https://github.com/basho/taste-of-riak">cloning</a> the source code repository or downloading the <a href="https://github.com/basho/taste-of-riak/archive/master.zip">current zip of the master branch</a>. Ensure that the source is located in your <code>GOPATH</code>. The code for this chapter is in <code>go/ch02/ch02.go</code>. You may import this code into your favorite editor, or just run it from the command line using the <code>Makefile</code> if you are running on a *nix OS.</p>

<blockquote>
<p>A Quick Note on Querying and Schemas:</p>

<p>Even with a key/value store, you will still have a logical database schema of how all the data relates to one another. This can be as simple as using the same key across multiple buckets for different types of data, to having fields in your data that are related by name. These querying methods will introduce you to some ways of laying out your data in Riak, along with how to query it back.</p>
</blockquote>

<p>###Denormalization</p>

<p>If you&rsquo;re coming from a relational database, the easiest way to get your application started with NoSQL is to denormalize your data into related chunks. For example with a customer database, you might have separate tables for Customers, Addresses, Preferences, etc. In Riak KV, you can denormalize all that associated data into a single object and store it into a <code>Customer</code> bucket.  You can keep pulling in associated data until you hit one of the big denormalization walls:</p>

<ul>
<li>Size Limits (objects greater than 1MB)</li>
<li>Shared/Referential Data (data that the object doesn&rsquo;t &ldquo;own&rdquo;)</li>
<li>Differences in Access Patterns (objects that get read/written once vs. often)</li>
</ul>

<p>At one of these points we will have to split the model.</p>

<p>###Same Keys - Different Buckets</p>

<p>The simplest way to split up data would be to use the same identity key across different buckets. A good example of this would be a <code>Customer</code> object, an <code>Order</code> object, and an <code>OrderSummaries</code> object that keeps rolled up info about orders such as Total, etc. Let&rsquo;s put some data into Riak KV so we can play with it.</p>

<pre><code class="language-golang">package main

import (
  &quot;encoding/json&quot;
  &quot;errors&quot;
  &quot;fmt&quot;
  &quot;reflect&quot;
  &quot;sync&quot;
  &quot;time&quot;

  riak &quot;github.com/basho/riak-go-client&quot;
  util &quot;github.com/basho/taste-of-riak/go/util&quot;
)

const (
  timeFmt              = &quot;2006-01-02 15:04:05&quot;
  customersBucket      = &quot;Customers&quot;
  ordersBucket         = &quot;Orders&quot;
  orderSummariesBucket = &quot;OrderSummaries&quot;
)

type Customer struct {
  Name        string
  Address     string
  City        string
  State       string
  Zip         string
  Phone       string
  CreatedDate time.Time
}

type Order struct {
  Id            string
  CustomerId    string
  SalespersonId string
  Items         []*OrderItem
  Total         float32
  Date          time.Time
}

type OrderItem struct {
  Id    string
  Title string
  Price float32
}

type OrderSummary struct {
  CustomerId string
  Summaries  []*OrderSummaryItem
}

type OrderSummaryItem struct {
  Id    string
  Total float32
  Date  time.Time
}

func main() {
  var err error
  var customerId string

  util.Log.Println(&quot;Creating Data&quot;)

  var cd time.Time
  cd, err = time.Parse(timeFmt, &quot;2013-10-01 14:30:26&quot;)
  if err != nil {
    util.ErrExit(err)
  }

  customer := &amp;Customer{
    Name:        &quot;John Smith&quot;,
    Address:     &quot;123 Main Street&quot;,
    City:        &quot;Columbus&quot;,
    State:       &quot;Ohio&quot;,
    Zip:         &quot;43210&quot;,
    Phone:       &quot;+1-614-555-5555&quot;,
    CreatedDate: cd,
  }

  util.Log.Printf(&quot;customer: %v&quot;, customer)

  util.Log.Println(&quot;Starting Client&quot;)

  // un-comment-out to enable debug logging
  // riak.EnableDebugLogging = true

  o := &amp;riak.NewClientOptions{
    RemoteAddresses: []string{util.GetRiakAddress()},
  }

  var c *riak.Client
  c, err = riak.NewClient(o)
  if err != nil {
    util.ErrExit(err)
  }

  defer func() {
    if err := c.Stop(); err != nil {
      util.ErrExit(err)
    }
  }()

  util.Log.Println(&quot;Storing Customer&quot;)

  var cmd riak.Command
  var customerJson []byte

  customerJson, err = json.Marshal(customer)
  if err != nil {
    util.ErrExit(err)
  }

  obj := &amp;riak.Object{
    Bucket:      customersBucket,
    ContentType: &quot;application/json&quot;,
    Value:       customerJson,
  }

  cmd, err = riak.NewStoreValueCommandBuilder().
    WithContent(obj).
    WithReturnBody(true).
    Build()
  if err != nil {
    util.ErrExit(err)
  }
  if eerr := c.Execute(cmd); eerr != nil {
    util.ErrExit(eerr)
  }

  svc := cmd.(*riak.StoreValueCommand)
  customerId = svc.Response.GeneratedKey
  if customerId == &quot;&quot; {
    util.ErrExit(errors.New(&quot;expected generated customer Id&quot;))
  } else {
    util.Log.Println(&quot;Customer ID:&quot;, customerId)
  }

  util.Log.Println(&quot;Storing Data&quot;)

  var orders []*Order
  orders, err = createOrders(customerId)
  if err != nil {
    util.ErrExit(err)
  }

  var orderSummary *OrderSummary
  var orderSummaryJson []byte
  orderSummary = createOrderSummary(customerId, orders)

  ccmds := 1 + len(orders)
  cmds := make([]riak.Command, ccmds)

  // command to store OrderSummary
  orderSummaryJson, err = json.Marshal(orderSummary)
  if err != nil {
    util.ErrExit(err)
  }
  obj = &amp;riak.Object{
    Bucket:      orderSummariesBucket,
    Key:         customerId,
    ContentType: &quot;application/json&quot;,
    Value:       orderSummaryJson,
  }
  cmds[0], err = riak.NewStoreValueCommandBuilder().
    WithContent(obj).
    Build()
  if err != nil {
    util.ErrExit(err)
  }

  for i, order := range orders {
    // command to store Order
    var orderJson []byte
    orderJson, err = json.Marshal(order)
    if err != nil {
      util.ErrExit(err)
    }
    obj = &amp;riak.Object{
      Bucket:      ordersBucket,
      Key:         order.Id,
      ContentType: &quot;application/json&quot;,
      Value:       orderJson,
    }
    cmds[i+1], err = riak.NewStoreValueCommandBuilder().
      WithContent(obj).
      Build()
    if err != nil {
      util.ErrExit(err)
    }
  }

  errored := false
  wg := &amp;sync.WaitGroup{}
  for _, cmd := range cmds {
    a := &amp;riak.Async{
      Command: cmd,
      Wait:    wg,
    }
    if eerr := c.ExecuteAsync(a); eerr != nil {
      errored = true
      util.ErrLog.Println(eerr)
    }
  }
  wg.Wait()
  if errored {
    util.ErrExit(errors.New(&quot;error, exiting!&quot;))
  }
}

func createOrders(customerId string) ([]*Order, error) {
  o := make([]*Order, 3)

  d, err := time.Parse(timeFmt, &quot;2013-10-01 14:42:26&quot;)
  if err != nil {
    return nil, err
  }
  o[0] = &amp;Order{
    Id:            &quot;1&quot;,
    CustomerId:    customerId,
    SalespersonId: &quot;9000&quot;,
    Items: []*OrderItem{
      {
        Id:    &quot;TCV37GIT4NJ&quot;,
        Title: &quot;USB 3.0 Coffee Warmer&quot;,
        Price: 15.99,
      },
      {
        Id:    &quot;PEG10BBF2PP&quot;,
        Title: &quot;eTablet Pro, 24GB; Grey&quot;,
        Price: 399.99,
      },
    },
    Total: 415.98,
    Date:  d,
  }

  d, err = time.Parse(timeFmt, &quot;2013-10-15 16:43:16&quot;)
  if err != nil {
    return nil, err
  }
  o[1] = &amp;Order{
    Id:            &quot;2&quot;,
    CustomerId:    customerId,
    SalespersonId: &quot;9001&quot;,
    Items: []*OrderItem{
      {
        Id:    &quot;OAX19XWN0QP&quot;,
        Title: &quot;GoSlo Digital Camera&quot;,
        Price: 359.99,
      },
    },
    Total: 359.99,
    Date:  d,
  }

  d, err = time.Parse(timeFmt, &quot;2013-11-03 17:45:28&quot;)
  if err != nil {
    return nil, err
  }
  o[2] = &amp;Order{
    Id:            &quot;3&quot;,
    CustomerId:    customerId,
    SalespersonId: &quot;9000&quot;,
    Items: []*OrderItem{
      {
        Id:    &quot;WYK12EPU5EZ&quot;,
        Title: &quot;Call of Battle : Goats - Gamesphere 4&quot;,
        Price: 69.99,
      },
      {
        Id:    &quot;TJB84HAA8OA&quot;,
        Title: &quot;Bricko Building Blocks&quot;,
        Price: 4.99,
      },
    },
    Total: 74.98,
    Date:  d,
  }

  return o, nil
}

func createOrderSummary(customerId string, orders []*Order) *OrderSummary {

  s := &amp;OrderSummary{
    CustomerId: customerId,
    Summaries:  make([]*OrderSummaryItem, len(orders)),
  }

  for i, o := range orders {
    s.Summaries[i] = &amp;OrderSummaryItem{
      Id:    o.Id,
      Total: o.Total,
      Date:  o.Date,
    }
  }

  return s
}
</code></pre>

<p>While individual <code>Customer</code> and <code>Order</code> objects don&rsquo;t change much (or shouldn&rsquo;t change), the <code>Order Summaries</code> object will likely change often. It will do double duty by acting as an index for all a customer&rsquo;s orders and also holding some relevant data, such as the order total, etc. If we showed this information in our application often, it&rsquo;s only one extra request to get all the info.</p>

<pre><code class="language-golang">util.Log.Println(&quot;Fetching related data by shared key&quot;)

cmds = cmds[:0]

// fetch customer
cmd, err = riak.NewFetchValueCommandBuilder().
  WithBucket(customersBucket).
  WithKey(customerId).
  Build()
if err != nil {
  util.ErrExit(err)
}
cmds = append(cmds, cmd)

// fetch OrderSummary
cmd, err = riak.NewFetchValueCommandBuilder().
  WithBucket(orderSummariesBucket).
  WithKey(customerId).
  Build()
if err != nil {
  util.ErrExit(err)
}
cmds = append(cmds, cmd)

doneChan := make(chan riak.Command)
errored = false
for _, cmd := range cmds {
  a := &amp;riak.Async{
    Command: cmd,
    Done:    doneChan,
  }
  if eerr := c.ExecuteAsync(a); eerr != nil {
    errored = true
    util.ErrLog.Println(eerr)
  }
}
if errored {
  util.ErrExit(errors.New(&quot;error, exiting!&quot;))
}

for i := 0; i &lt; len(cmds); i++ {
  select {
  case d := &lt;-doneChan:
    if fv, ok := d.(*riak.FetchValueCommand); ok {
      obj := fv.Response.Values[0]
      switch obj.Bucket {
      case customersBucket:
        util.Log.Printf(&quot;Customer     1: %v&quot;, string(obj.Value))
      case orderSummariesBucket:
        util.Log.Printf(&quot;OrderSummary 1: %v&quot;, string(obj.Value))
      }
    } else {
      util.ErrExit(fmt.Errorf(&quot;unknown response command type: %v&quot;, reflect.TypeOf(d)))
    }
  case &lt;-time.After(5 * time.Second):
    util.ErrExit(errors.New(&quot;fetch operations took too long&quot;))
  }
}
</code></pre>

<p>Which returns our amalgamated objects:</p>

<pre><code class="language-sh">2015/12/29 09:44:10 OrderSummary 1: {&quot;CustomerId&quot;:&quot;I4R9AdTpJ7RL13qj14ED9Qjzbyy&quot;,&quot;Summaries&quot;:[{&quot;Id&quot;:&quot;1&quot;,&quot;Total&quot;:415.98,&quot;Date&quot;:&quot;2013-10-01T14:42:26Z&quot;},{&quot;Id&quot;:&quot;2&quot;,&quot;Total&quot;:359.99,&quot;Date&quot;:&quot;2013-10-15T16:43:16Z&quot;},{&quot;Id&quot;:&quot;3&quot;,&quot;Total&quot;:74.98,&quot;Date&quot;:&quot;2013-11-03T17:45:28Z&quot;}]}
2015/12/29 09:44:10 Customer     1: {&quot;Name&quot;:&quot;John Smith&quot;,&quot;Address&quot;:&quot;123 Main Street&quot;,&quot;City&quot;:&quot;Columbus&quot;,&quot;State&quot;:&quot;Ohio&quot;,&quot;Zip&quot;:&quot;43210&quot;,&quot;Phone&quot;:&quot;+1-614-555-5555&quot;,&quot;CreatedDate&quot;:&quot;2013-10-01T14:30:26Z&quot;
</code></pre>

<p>While this pattern is very easy and extremely fast with respect to queries and complexity, it&rsquo;s up to the application to know about these intrinsic relationships.</p>

<p>###Secondary Indexes</p>

<p>If you&rsquo;re coming from a SQL world, Secondary Indexes (2i) are a lot like SQL indexes. They are a way to quickly look up objects based on a secondary key, without scanning through the whole dataset. This makes it very easy to find groups of related data by values or ranges of values. To properly show this off, we will add some more data to our application, and add some secondary index entries at the same time:</p>

<pre><code class="language-golang">util.Log.Println(&quot;Adding Index Data&quot;)

// fetch orders to add index data
cmds = cmds[:0]

for _, order := range orders {
  cmd, err = riak.NewFetchValueCommandBuilder().
    WithBucket(ordersBucket).
    WithKey(order.Id).
    Build()
  if err != nil {
    util.ErrExit(err)
  }
  cmds = append(cmds, cmd)
}

errored = false
for _, cmd := range cmds {
  a := &amp;riak.Async{
    Command: cmd,
    Done:    doneChan,
  }
  if eerr := c.ExecuteAsync(a); eerr != nil {
    errored = true
    util.ErrLog.Println(eerr)
  }
}
if errored {
  util.ErrExit(errors.New(&quot;error, exiting!&quot;))
}

errored = false
for i := 0; i &lt; len(cmds); i++ {
  select {
  case d := &lt;-doneChan:
    if fv, ok := d.(*riak.FetchValueCommand); ok {
      obj := fv.Response.Values[0]
      switch obj.Key {
      case &quot;1&quot;:
        obj.AddToIntIndex(&quot;SalespersonId_int&quot;, 9000)
        obj.AddToIndex(&quot;OrderDate_bin&quot;, &quot;2013-10-01&quot;)
      case &quot;2&quot;:
        obj.AddToIntIndex(&quot;SalespersonId_int&quot;, 9001)
        obj.AddToIndex(&quot;OrderDate_bin&quot;, &quot;2013-10-15&quot;)
      case &quot;3&quot;:
        obj.AddToIntIndex(&quot;SalespersonId_int&quot;, 9000)
        obj.AddToIndex(&quot;OrderDate_bin&quot;, &quot;2013-11-03&quot;)
      }
      scmd, serr := riak.NewStoreValueCommandBuilder().
        WithContent(obj).
        Build()
      if serr != nil {
        util.ErrExit(serr)
      }
      a := &amp;riak.Async{
        Command: scmd,
        Wait:    wg,
      }
      if eerr := c.ExecuteAsync(a); eerr != nil {
        errored = true
        util.ErrLog.Println(eerr)
      }
    } else {
      util.ErrExit(fmt.Errorf(&quot;unknown response command type: %v&quot;, reflect.TypeOf(d)))
    }
  case &lt;-time.After(5 * time.Second):
    util.ErrExit(errors.New(&quot;fetch operations took too long&quot;))
  }
}

if errored {
  util.ErrExit(errors.New(&quot;error, exiting!&quot;))
}

wg.Wait()
close(doneChan)
</code></pre>

<p>As you may have noticed, ordinary key/value data is opaque to 2i, so we have to add entries to the indexes at the application level.</p>

<p>Now let&rsquo;s find all of Jane Appleseed&rsquo;s processed orders. We&rsquo;ll lookup the orders by searching the <code>saleperson_id_int</code> index for Jane&rsquo;s id of <code>9000</code>:</p>

<pre><code class="language-golang">util.Log.Println(&quot;Index Queries&quot;)

cmd, err = riak.NewSecondaryIndexQueryCommandBuilder().
  WithBucket(ordersBucket).
  WithIndexName(&quot;SalespersonId_int&quot;).
  WithIndexKey(&quot;9000&quot;).
  Build()
if err != nil {
  util.ErrExit(err)
}

if eerr := c.Execute(cmd); eerr != nil {
  util.ErrExit(eerr)
}

qcmd := cmd.(*riak.SecondaryIndexQueryCommand)
for _, rslt := range qcmd.Response.Results {
  util.Log.Println(&quot;Jane's Orders, key: &quot;, string(rslt.ObjectKey))
}
</code></pre>

<p>Which returns:</p>

<pre><code class="language-sh">2015/12/29 09:44:10 Jane's Orders, key:  3
2015/12/29 09:44:10 Jane's Orders, key:  1
</code></pre>

<p>Jane processed orders 1 and 3.  We used an <em>integer</em> index to reference Jane&rsquo;s id, next let&rsquo;s use a <em>binary</em> index.</p>

<p>Let&rsquo;s say that the VP of Sales wants to know how many orders came in during October 2013. In this case, we can exploit 2i&rsquo;s range queries. Let&rsquo;s search the <code>order_date_bin</code> index for entries between <code>20131001</code> and <code>20131031</code>:</p>

<pre><code class="language-golang">cmd, err = riak.NewSecondaryIndexQueryCommandBuilder().
  WithBucket(ordersBucket).
  WithIndexName(&quot;OrderDate_bin&quot;).
  WithRange(&quot;2013-10-01&quot;, &quot;2013-10-31&quot;).
  Build()
if err != nil {
  util.ErrExit(err)
}

if eerr := c.Execute(cmd); eerr != nil {
  util.ErrExit(eerr)
}

qcmd = cmd.(*riak.SecondaryIndexQueryCommand)
for _, rslt := range qcmd.Response.Results {
  util.Log.Println(&quot;October's Orders, key: &quot;, string(rslt.ObjectKey))
}
</code></pre>

<p>Which returns:</p>

<pre><code class="language-sh">2015/12/29 09:44:10 October's Orders, key:  1
2015/12/29 09:44:10 October's Orders, key:  2
</code></pre>

<p>Easy!  We used 2i&rsquo;s range feature to search for a range of values, and demonstrated binary indexes.</p>

<p>So to recap:</p>

<ul>
<li>You can use Secondary Indexes to quickly lookup an object based on a secondary id other than the object&rsquo;s key.</li>
<li>Indexes can have either Integer or Binary(String) keys.</li>
<li>You can search for specific values or a range of values.</li>
<li>Riak will return a list of keys that match the index query.</li>
</ul>


      <div class="clear"></div>

    </article>

    <footer class="mastfooter">
    This work is licensed under a
    <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
        Creative Commons Attribution 4.0 International Public License
    </a><br>
    &copy; 2011-2016&nbsp;<a href="http://www.basho.com">Basho Technologies, Inc.</a>
</footer>


  </div>

  <script src="/js/all.js" type="text/javascript"></script>
<script type= "text/javascript">
  
  hljs.configure({languages: []});
  hljs.initHighlighting();

  
  
  
  $(function() {
    $(".js_enabled pre").css("visibility", "visible");
  });
</script>


</body>
</html>
