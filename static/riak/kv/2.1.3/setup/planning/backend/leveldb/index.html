<!DOCTYPE html>

<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"></html><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8" lang="en"></html><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9" lang="en"></html><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]-->




<head class="tutorials">
  <meta charset="utf-8">
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width">
  <meta name="project" content="riak_kv">
  <meta name="version" content="2.1.3">
  <meta name="base-url" content="">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  <title>LevelDB</title>

  <link href="/css/all.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/css/print.css" media="print" rel="stylesheet" type="text/css">

  
  <style type="text/css"> .js_enabled pre { visibility : hidden; } </style>
  <script type="text/javascript">
    document.documentElement.className = 'js_enabled';
  </script>
</head>



<body class="riak_kv 2.1.3 latest ">

  <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-T9C8MK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-T9C8MK');</script>

  
<aside id="nav-container" role="complementary">
  <nav class="overview" id="primary-nav" role="nav">
    <div id="primary-nav-content">
      <h2 class="responsive-link"><a class="responsive-toggle"></a></h2>

      
      <form id="searchbox_011972015458788978446:zgdcy4fa-o0" action="">
        <div class="nav-field-container">
          <div id="icon-container-search">
            <div class="icon-container"><span aria-hidden="true" class="nav-icon-search icon-search"></span></div>
            <span class="separator">&#124;</span>
          </div>
          <input id="main-search" name="q" placeholder="Search" size="5" type="search" />
        </div>
      </form>

      <div class="clear"></div>

      
      <h3 class="responsive-link visit-basho">
        <a href="http://www.basho.com">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">Visit Basho</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      <h3 class="responsive-link">
        <a href="/index.html">
          <div class="icon-container">
            <span aria-hidden="true" class="nav-icon" data-icon="&#xe003;"></span>
          </div>
          <span class="separator">&#124;</span>
          <span class="menu-title">All Riak Projects</span>
          <div class="clear"></div>
        </a>
      </h3>

      
      
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-riak"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/">Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-download-alt"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/downloads/">Download Riak KV</a></span>
        <div class="clear"></div>
      </h3>
      
       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-install"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/setup/">Setup</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/">Planning</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/start/">Start Planning</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/operating-system/">OS Support</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/planning/backend/">Choosing a Backend</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/bitcask/">Bitcask</a>
  
  </li>
  <li class="current">
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/leveldb/">LevelDB</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/memory/">Memory</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/backend/multi/">Multi-backend</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/cluster-capacity/">Cluster Capacity</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/bitcask-capacity-calc/">Bitcask Capacity Calculator</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/planning/future/">Planning for the Future</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/">Installing</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/amazon-web-services/">Amazon Web Services</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/debian-ubuntu/">Debian &amp; Ubuntu</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/freebsd/">FreeBSD</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/mac-osx/">Mac OS X</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/rhel-centos/">RHEL &amp; CentOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/smartos/">SmartOS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/solaris/">Solaris</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/suse/">SUSE</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/windows-azure/">Windows Azure</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/installing/source/">Installing From Source</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/erlang/">Installing Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/source/jvm/">Installing the JVM</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/installing/verify/">Verifying an Installation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/setup/upgrading/">Upgrading</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/checklist/">Production Checklist</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/version/">Upgrading by Version</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/cluster/">Upgrading a Cluster</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/multi-datacenter/">Upgrading Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/setup/upgrading/downgrade/">Downgrading</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-cog"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/configuring/">Configuring</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/basic/">Basic Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/backend/">Backend Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/managing/">Managing Configuration</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/reference/">Configuration Reference</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/strong-consistency/">Implementing Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/load-balancing-proxy/">Load Balancing &amp; Proxy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/mapreduce/">MapReduce Settings</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/search/">Search Settings</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/">V3 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v3-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/">V2 Multi-Datacenter</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/quick-start/">Quickstart</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/nat/">With NAT</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/configuring/v2-multi-datacenter/ssl/">SSL</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-database"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/using/">Using</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/running-a-cluster/">Running a Cluster</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/admin/">Cluster Administration</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/commands/">Cluster Admin Commands</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-admin/">riak-admin CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-cli/">riak CLI</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/admin/riak-control/">Riak Control</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/cluster-operations/">Cluster Operations</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/adding-removing-nodes/">Adding/Removing Nodes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/changing-cluster-info/">Changing Cluster Information</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/replacing-node/">Replacing a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/inspecting-node/">Inspecting a Node</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backing-up/">Backing Up</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/secondary-indexes/">Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/monitoring-strong-consistency/">Monitoring Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/load-balancing/">Load Balancing</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/backend/">Backend</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v3-multi-datacenter/">V3 Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/cluster-operations/v2-multi-datacenter/">V2 Multi-Datacenter</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/repair-recovery/">Repair &amp; Recovery</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/errors/">Errors</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/repairs/">Repairs</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/repair-recovery/rolling-restart/">Rolling Restarts</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/security/">Security</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/basics/">Security Basics</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/managing-sources/">Managing Security Sources</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/best-practices/">Best Practices</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/security/v2-v3-ssl-ca/">V2/V3 SSL &amp; CA Validation</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/performance/">Performance</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/benchmarking/">Benchmarking</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/open-files-limit/">Open Files Limit</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/v2-scheduling-fullsync/">V2 Scheduling Fullsync</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/performance/multi-datacenter-tuning/">Multi-Datacenter Replication</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/">Troubleshooting</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/">Product Advisories</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/210-dataloss/">Default Configuration For Handoff May Cause Data Loss</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/appconfig-foward/">Forward Incompatibility of app.config</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/dvv-lastwritewins/">Incompatibility between Dotted Version Vectors and Last Write Wins</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/maps-204/">Map Data Type Disk Incompatibility</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/product-advisories/ssl-poodle/">SSL 3.0 Vulnerability and POODLE Attack</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/troubleshooting/http-204/">HTTP 204</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/using/reference/">Reference</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/logging/">Logging</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/handoff/">Handoff</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/object-deletion/">Object Deletion</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/runtime-interaction/">Runtime Interaction</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/failure-recovery/">Failure &amp; Recovery</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/monitoring/">Monitoring</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/search-secondary-indexes/">Search &amp; Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/multi-datacenter/">Multi-Datacenter</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v3/">V3 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/v2/">V2 Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/using/reference/architecture/">Architecture</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-lambda"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/developing/">Developing</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/">Getting Started</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/java/">Java</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/java/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/ruby/">Ruby</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/ruby/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/python/">Python</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/python/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/csharp/">C Sharp</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/csharp/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/nodejs/">NodeJS</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/nodejs/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/erlang/">Erlang</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/erlang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/golang/">Go</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/querying/">Querying</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/golang/object-modeling/">Object Modeling</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/getting-started/php/">PHP</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/crud-operations/">CRUD Operations</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/getting-started/php/querying/">Querying</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/">Usage</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/creating-objects/">Creating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/reading-objects/">Reading Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/updating-objects/">Updating Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/deleting-objects/">Deleting Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/content-types/">Content Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search/">Searching</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/mapreduce/">Using MapReduce</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/secondary-indexes/">Using Secondary Indexes</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/bucket-types/">Bucket Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/commit-hooks/">Using Commit Hooks</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/search-schemas/">Creating Search Schemas</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/searching-data-types/">Searching with Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/document-store/">Implementing a Document Store</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/custom-extractors/">Custom Extractors</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/security/">Security</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/erlang/">Erlang</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/security/php/">PHP</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/replication/">Replication</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/">Conflict Resolution</a></span></h4>
    
<ul class="depth-3">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/java/">Java</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/ruby/">Ruby</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/python/">Python</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/csharp/">C Sharp</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/nodejs/">NodeJS</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/php/">PHP</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/usage/conflict-resolution/golang/">Go</a>
  
  </li></ul>

  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-types/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/data-modeling/">Data Modeling</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/app-guide/">Application Guide</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/replication-properties/">Replication Properties</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/strong-consistency/">Strong Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/write-once/">Write Once</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/app-guide/reference/">Reference</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/client-libraries/">Client Libraries</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/developing/api/">APIs</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/repl-hooks/">V2 Multi-Datacenter REPL Hooks API</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/api/backend/">Backend API</a>
  
  </li></ul>

  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/developing/faq/">Developing FAQ</a>
  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-beaker"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/riak/kv/2.1.3/learn/">Learning</a></span>
        <div class="clear"></div>
      </h3>
      
      
        
<ul class="depth-1">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/why-riak-kv/">Why Riak KV?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/use-cases/">Use Cases</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/new-to-nosql/">New to NoSQL?</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/glossary/">Riak KV Glossary</a>
  
  </li>
  <li >
  
    <h4><span><a href="/riak/kv/2.1.3/learn/concepts/">Concepts</a></span></h4>
    
<ul class="depth-2">
  
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/active-anti-entropy/">Active Anti-Entropy</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/buckets/">Buckets</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/capability-negotiation/">Capability Negotiation</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/causal-context/">Causal Context</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/clusters/">Clusters</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/crdts/">Data Types</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/eventual-consistency/">Eventual Consistency</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/keys-and-objects/">Keys and Objects</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/replication/">Replication</a>
  
  </li>
  <li >
  
    <a href="/riak/kv/2.1.3/learn/concepts/vnodes/">Vnodes</a>
  
  </li></ul>

  
  </li></ul>

       
      <h3>
        <div class="icon-container"><span aria-hidden="true" class="nav-icon icon-comments"></span>&nbsp;</div>
        <span class="separator">&#124;</span>
        <span class="menu-title"><a href="/community">Community</a></span>
        <div class="clear"></div>
      </h3>
      <ul></ul> 
    </div>
  </nav>

  
  <ul id="fixed-nav">
    <li>
      <a href="https://github.com/basho/basho_docs" target="_blank">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xe004;"></span>
        </div>
        <span class="separator">&#124;</span>Available on GitHub
      </a>
    </li>
    <li>
      <a href="/riak/latest/community/">
        <div class="icon-container">
          <span aria-hidden="true" class="nav-icon" data-icon="&#xf059;"></span>
        </div>
        <span class="separator">&#124;</span>Get Help
      </a>
    </li>
  </ul>
</aside>


  <script>
  (function() {
    var cx = '011972015458788978446:zgdcy4fa-o0';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div style="width:0px;overflow:hidden;height:0px;">
  <gcse:search></gcse:search>
</div>


  <div role="main">

    <header class="masthead">
  <div id="header">
    
    <div id="header-inner">
      <div class="icon-reorder" id="nav-toggle"></div>

      <div id="top-nav">
        
        <a href="/riak/kv/2.1.3/downloads/"><span class="icon-download-alt"></span>Downloads</a>
        <div id="nav-more"><span class="icon-more"></span></div>
      </div>

      <a class="responsive-toggle"></a>
      
      
      <a class="logo" href="/index.html"><h1>Riak Docs</h1></a>
      
      <span class="tagline">Product tutorials, how-tos, and fully-documented APIs.</span>
      <div id="nav-menu">
        <h2>Links</h2>
        <ul>
          <li><a href="http://docs.basho.com/">Docs Home</a></li>
          <li><a href="http://basho.com/">Basho Website</a></li>
        </ul>
        
        <div id="nav-menu-arrow"></div>
        <div id="nav-menu-arrow-back"></div>
      </div>

      <div class="clear"></div>

      <div class="header-rule"></div>
    </div>
  </div>
</header>


    <article class="mainarticle">

      <div class="versions">
  <div id="version-ddown-button" class="unselected">
    <div class="version-ddown-title">Version</div>
    <div class="version-ddown-number">2.1.3</div>
    <div class="version-ddown-arrow"></div>
  </div>
  <ol id="version-list" style="display: none;">
  
  
    
    
      
      
      <li class="sans versions-0 current">DEV</li>
      
      <li class="current versions-0"><a class="versioned" href="/riak/kv/2.1.3/setup/planning/backend/leveldb/">2.1.3</a></li>
    
    
      
      
      
      <li class=" versions-0 first"><a class="versioned" href="/riak/kv/2.1.1/setup/planning/backend/leveldb/">2.1.1</a></li>
    
  
    
    
      
      
      
      <li class="sans versions-1 current">LTS</li>
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.6/setup/planning/backend/leveldb/">2.0.6</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.5/setup/planning/backend/leveldb/">2.0.5</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.4/setup/planning/backend/leveldb/">2.0.4</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.2/setup/planning/backend/leveldb/">2.0.2</a></li>
    
      
      
      
      
      <li class=" versions-1"><a class="versioned" href="/riak/kv/2.0.1/setup/planning/backend/leveldb/">2.0.1</a></li>
    
    
      
      
      
      <li class=" versions-1 first"><a class="versioned" href="/riak/kv/2.0.0/setup/planning/backend/leveldb/">2.0.0</a></li>
    
  
  
  <li class="versions-5 first"><a class="sans versioned" href="http://docs.basho.com/riak/1.4.12/">older</a></li>
  </ol>
</div>


      
      

      <header><h1>LevelDB</h1></header>

      

      
      <nav id="toc">
        <h2 class="title">Contents</h2>
        <div id="toc-wrapper">
          <ol id="toc-items"></ol>
        </div>
      </nav>
      

      

<blockquote>
<p><strong>Note on upgrading to 2.0</strong></p>

<p>If you are using LevelDB in a 1.x version of Riak, are upgrading to 2.0,
and wish to keep using your old <code>app.config</code> file for configuration,
make sure to follow the steps for setting the
<code>total_leveldb_mem_percent</code> parameter in the
<a href="/">2.0 upgrade guide</a>.</p>
</blockquote>

<p><a href="https://github.com/basho/eleveldb">eLevelDB</a> is an Erlang application
that encapsulates <a href="http://code.google.com/p/leveldb/">LevelDB</a>, an
open-source, on-disk key/value store created by Google Fellows Jeffrey
Dean and Sanjay Ghemawat.</p>

<p>LevelDB is a relatively new entrant into the growing list of key/value
database libraries, but it has some very interesting qualities that we
believe make it an ideal candidate for use in Riak. LevelDB&rsquo;s storage
architecture is more like
<a href="http://en.wikipedia.org/wiki/BigTable">BigTable&rsquo;s</a> memtable/sstable
model than it is like Bitcask. This design and implementation provide
the possibility of a storage engine without Bitcask&rsquo;s RAM limitation.</p>

<blockquote>
<p><strong>Note:</strong> Riak uses a fork of LevelDB. The code can be found
<a href="https://github.com/basho/leveldb">on Github</a>.</p>
</blockquote>

<p>A number of changes have been introduced in the LevelDB backend in Riak
2.0:</p>

<ul>
<li>There is now only <em>one</em> performance-related setting that Riak users
need to define&mdash;<code>leveldb.total_mem_percent</code>&mdash;as LevelDB now
dynamically sizes the file cache and block sizes based upon active
<a href="/riak/kv/2.1.3/learn/glossary/#Vnode">vnodes</a> assigned to the node.</li>
<li>The LevelDB backend in Riak 2.0 utilizes a new, faster threading model
for background compaction work on <code>.sst</code> table files. The new model
has increased throughput by at least 10% in all test scenarios.</li>
<li>Delete operations now receive priority handling in compaction
selection, which means more aggressive reclaiming of disk space than
in previous versions of Riak&rsquo;s LevelDB backend.</li>
<li>Nodes storing massive key datasets (e.g. in the billions of keys) now
receive increased throughput due to automatic management of LevelDB&rsquo;s
block size parameter. This parameter is slowly raised to increase the
number of files that can open simultaneously, improving random read
performance.</li>
</ul>

<h2 id="strengths:f3b9fd04cefdda84e52c48fa0009bd9f">Strengths</h2>

<ol>
<li><strong>License</strong> &mdash; The LevelDB and eLevelDB licenses are the <a href="http://www.opensource.org/licenses/bsd-license.php">New BSD
License</a> and the
<a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache 2.0 License</a>,
respectively. We&rsquo;d like to thank Google and the authors of LevelDB at
Google for choosing a completely FLOSS license so that everyone can
benefit from this innovative storage engine.</li>
<li><strong>Data compression</strong> &mdash; LevelDB uses Google
<a href="https://code.google.com/p/snappy/">Snappy</a> data compression by
default. This means more CPU usage but less disk space. The
compression efficiency is especially good for text data, including
raw text, Base64, JSON, etc.</li>
</ol>

<h2 id="weaknesses:f3b9fd04cefdda84e52c48fa0009bd9f">Weaknesses</h2>

<ol>
<li>Read access can be slow when there are many levels to search</li>
<li>LevelDB may have to do a few disk seeks to satisfy a read; one disk
seek per level and, if 10% of the database fits in memory, one seek
for the last level (since all of the earlier levels should end up
cached in the OS buffer cache for most filesystems) whereas if 1%
fits in memory, LevelDB will need two seeks.</li>
</ol>

<h2 id="installing-eleveldb:f3b9fd04cefdda84e52c48fa0009bd9f">Installing eLevelDB</h2>

<p>Riak ships with eLevelDB included within the distribution, so there is
no separate installation required. However, Riak is configured to use
the Bitcask storage engine by default. To switch to eLevelDB, set the
<code>storage_backend</code> variable in <a href="/riak/kv/2.1.3/configuring/reference"><code>riak.conf</code></a> to
<code>leveldb</code>:</p>

<pre><code class="language-riakconf">storage_backend = leveldb
</code></pre>

<pre><code class="language-appconfig">{riak_kv, [
    %% ...
    {storage_backend, riak_kv_eleveldb_backend},
    %% ...
    ]}
</code></pre>

<h2 id="configuring-eleveldb:f3b9fd04cefdda84e52c48fa0009bd9f">Configuring eLevelDB</h2>

<p>eLevelDb&rsquo;s default behavior can be modified by adding/changing
parameters in the <code>eleveldb</code> section of the <a href="/riak/kv/2.1.3/configuring/reference"><code>riak.conf</code></a>. The section below details the parameters you&rsquo;ll use to modify eLevelDB.</p>

<p>The configuration values that can be set in your
<a href="/riak/kv/2.1.3/configuring/reference"><code>riak.conf</code></a> for eLevelDB are as follows:</p>

<table>
<thead>
<tr>
<th align="left">Config</th>
<th align="left">Description</th>
<th align="left">Default</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>leveldb.data_root</code></td>
<td align="left">LevelDB data root</td>
<td align="left"><code>./data/leveldb</code></td>
</tr>

<tr>
<td align="left"><code>leveldb.maximum_memory.percent</code></td>
<td align="left">Defines the percentage (between 1 and 100) of total server memory to assign to LevelDB. LevelDB will dynamically adjust its internal cache sizes as Riak activates/inactivates <a href="/riak/kv/2.1.3/learn/glossary/#Vnode">vnodes</a> on this server to stay within this size.</td>
<td align="left"><code>70</code></td>
</tr>
</tbody>
</table>

<p>If you are using the older, <code>app.config</code>-based system, the equivalent to
the <code>leveldb.data_root</code> is the <code>data_root</code> setting, as in the following
example:</p>

<pre><code class="language-appconfig">{eleveldb, [
    {data_root, &quot;/path/to/leveldb&quot;},

    %% Other eleveldb-specific settings
]}
</code></pre>

<p>The <code>leveldb.maximum_memory.percent</code> setting is only available in the
newer configuration system.</p>

<h3 id="recommended-settings:f3b9fd04cefdda84e52c48fa0009bd9f">Recommended Settings</h3>

<p>Below are <strong>general</strong> configuration recommendations for Linux
distributions. Individual users may need to tailor these settings for
their application.</p>

<h4 id="sysctl:f3b9fd04cefdda84e52c48fa0009bd9f">sysctl</h4>

<p>For production environments, please see <a href="/riak/kv/2.1.3/using/performance">System Performance Tuning</a>
for the recommended <code>/etc/sysctl.conf</code> settings.</p>

<h4 id="block-device-scheduler:f3b9fd04cefdda84e52c48fa0009bd9f">Block Device Scheduler</h4>

<p>Beginning with the 2.6 kernel, Linux gives you a choice of four I/O
<a href="http://www.gnutoolbox.com/linux-io-elevator/">elevator models</a>. We
recommend using the NOOP elevator. You can do this by changing the
scheduler on the Linux boot line: <code>elevator=noop</code>.</p>

<h4 id="ext4-options:f3b9fd04cefdda84e52c48fa0009bd9f">ext4 Options</h4>

<p>The ext4 filesystem defaults include two options that increase integrity
but slow performance. Because Riak&rsquo;s integrity is based on multiple
nodes holding the same data, these two options can be changed to boost
LevelDB&rsquo;s performance. We recommend setting: <code>barrier</code>=0 and
<code>data</code>=writeback.</p>

<h4 id="cpu-throttling:f3b9fd04cefdda84e52c48fa0009bd9f">CPU Throttling</h4>

<p>If CPU throttling is enabled, disabling it can boost LevelDB performance
in some cases.</p>

<h4 id="no-entropy:f3b9fd04cefdda84e52c48fa0009bd9f">No Entropy</h4>

<p>If you are using https protocol, the 2.6 kernel is widely known for
stalling programs waiting for SSL entropy bits. If you are using https,
we recommend installing the
<a href="http://www.irisa.fr/caps/projects/hipsor/">HAVEGE</a> package for
pseudorandom number generation.</p>

<h4 id="clocksource:f3b9fd04cefdda84e52c48fa0009bd9f">clocksource</h4>

<p>We recommend setting <code>clocksource=hpet</code> on your Linux kernel&rsquo;s <code>boot</code>
line. The TSC clocksource has been identified to cause issues on
machines with multiple physical processors and/or CPU throttling.</p>

<h4 id="swappiness:f3b9fd04cefdda84e52c48fa0009bd9f">swappiness</h4>

<p>We recommend setting <code>vm.swappiness=0</code> in <code>/etc/sysctl.conf</code>. The
<code>vm.swappiness</code> default is 60, which is aimed toward laptop users with
application windows. This was a key change for MySQL servers and is
often referenced in database performance literature.</p>

<h2 id="implementation-details:f3b9fd04cefdda84e52c48fa0009bd9f">Implementation Details</h2>

<p><a href="http://leveldb.googlecode.com/svn/trunk/doc/impl.html">LevelDB</a> is a
Google-sponsored open source project that has been incorporated into an
Erlang application and integrated into Riak for storage of key/value
information on disk. The implementation of LevelDB is similar in spirit
to the representation of a single Bigtable tablet (section 5.3).</p>

<h3 id="how-levels-are-managed:f3b9fd04cefdda84e52c48fa0009bd9f">How Levels Are Managed</h3>

<p>LevelDB is a memtable/sstable design. The set of sorted tables is
organized into a sequence of levels. Each level stores approximately ten
times as much data as the level before it. The sorted table generated
from a flush is placed in a special young level (also called level-0).
When the number of young files exceeds a certain threshold (currently
four), all of the young files are merged together with all of the
overlapping level-1 files to produce a sequence of new level-1 files (a
new level-1 file is created for every 2MB of data.)</p>

<p>Files in the young level may contain overlapping keys. However files in
other levels have distinct non-overlapping key ranges. Consider level
number L where L &gt;= 1. When the combined size of files in level-L
exceeds (10^L) MB (i.e.  10MB for level-1, 100MB for level-2, &hellip;), one
file in level-L, and all of the overlapping files in level-(L+1) are
merged to form a set of new files for level-(L+1). These merges have the
effect of gradually migrating new updates from the young level to the
largest level using only bulk reads and writes (i.e., minimizing
expensive disk seeks).</p>

<p>When the size of level L exceeds its limit, LevelDB will compact it in a
background thread. The compaction picks a file from level L and all
overlapping files from the next level L+1. Note that if a level-L file
overlaps only part of a level-(L+1) file, the entire file at level-(L+1)
is used as an input to the compaction and will be discarded after the
compaction. Compactions from level-0 to level-1 are treated specially
because level-0 is special (files in it may overlap each other). A
level-0 compaction may pick more than one level-0 file in case some of
these files overlap each other.</p>

<p>A compaction merges the contents of the picked files to produce a
sequence of level-(L+1) files. LevelDB will switch to producing a new
level-(L+1) file after the current output file has reached the target
file size (2MB). LevelDB will also switch to a new output file when the
key range of the current output file has grown enough to overlap more
then ten level-(L+2) files. This last rule ensures that a later
compaction of a level-(L+1) file will not pick up too much data from
level-(L+2).</p>

<p>Compactions for a particular level rotate through the key space. In more
detail, for each level L, LevelDB remembers the ending key of the last
compaction at level L. The next compaction for level L will pick the
first file that starts after this key (wrapping around to the beginning
of the key space if there is no such file).</p>

<p>Level-0 compactions will read up to four 1MB files from level-0, and at
worst all the level-1 files (10MB) (i.e., LevelDB will read 14MB and
write 14MB in that case).</p>

<p>Other than the special level-0 compactions, LevelDB will pick one 2MB
file from level L. In the worst case, this will overlap with
approximately 12 files from level L+1 (10 because level-(L+1) is ten
times the size of level-L, and another two at the boundaries since the
file ranges at level-L will usually not be aligned with the file ranges
at level-L+1). The compaction will therefore read 26MB, write 26MB.
Assuming a disk IO rate of 100MB/s, the worst compaction cost will be
approximately 0.5 second.</p>

<p>If we throttle the background writing to a reasonably slow rate, for
instance 10% of the full 100MB/s speed, a compaction may take up to 5
seconds. If the user is writing at 10MB/s, LevelDB might build up lots
of level-0 files (~50 to hold the 5*10MB). This may significantly
increase the cost of reads due to the overhead of merging more files
together on every read.</p>

<h3 id="compaction:f3b9fd04cefdda84e52c48fa0009bd9f">Compaction</h3>

<p>Levels are compacted into ordered data files over time. Compaction first
computes a score for each level as the ratio of bytes in that level to
desired bytes. For level 0, it computes files / desired files instead.
The level with the highest score is compacted.</p>

<p>When compacting L0 the only special case to consider is that after
picking the primary L0 file to compact, it will check other L0 files to
determine the degree to which they overlap. This is an attempt to avoid
some I/O, we can expect L0 compactions to usually if not always be &ldquo;all
L0 files&rdquo;.</p>

<p>See the PickCompaction routine in
<a href="https://github.com/basho/leveldb/blob/develop/db/version_set.cc">1</a>
for all the details.</p>

<h3 id="comparison-of-eleveldb-and-bitcask:f3b9fd04cefdda84e52c48fa0009bd9f">Comparison of eLevelDB and Bitcask</h3>

<p>LevelDB is a persistent ordered map; Bitcask is a persistent hash table
(no ordered iteration). Bitcask stores keys in memory, so for databases
with large number of keys it may exhaust available physical memory and
then swap into virtual memory causing a severe slow down in performance.
Bitcask guarantees at most one disk seek per look-up. LevelDB may have
to do a small number of disk seeks. For instance, a read needs one disk
seek per level. If 10% of the database fits in memory, LevelDB will need
to do one seek (for the last level since all of the earlier levels
should end up cached in the OS buffer cache). If 1% fits in memory,
LevelDB will need two seeks.</p>

<h2 id="recovery:f3b9fd04cefdda84e52c48fa0009bd9f">Recovery</h2>

<p>LevelDB never writes in place: it always appends to a log file, or
merges existing files together to produce new ones. So an OS crash will
cause a partially written log record (or a few partially written log
records). LevelDB recovery code uses checksums to detect this and will
skip the incomplete records.</p>

<h3 id="eleveldb-database-files:f3b9fd04cefdda84e52c48fa0009bd9f">eLevelDB Database Files</h3>

<p>Below are two directory listings showing what you would expect to find
on disk when using eLevelDB. In this example, we use a 64-partition ring
which results in 64 separate directories, each with their own LevelDB
database:</p>

<pre><code class="language-bash">leveldb/
|-- 0
|   |-- 000003.log
|   |-- CURRENT
|   |-- LOCK
|   |-- LOG
|   `-- MANIFEST-000002
|-- 1004782375664995756265033322492444576013453623296
|   |-- 000005.log
|   |-- CURRENT
|   |-- LOCK
|   |-- LOG
|   |-- LOG.old
|   `-- MANIFEST-000004
|-- 1027618338748291114361965898003636498195577569280
|   |-- 000005.log
|   |-- CURRENT
|   |-- LOCK
|   |-- LOG
|   |-- LOG.old
|   `-- MANIFEST-000004

... etc ...

`-- 981946412581700398168100746981252653831329677312
    |-- 000005.log
    |-- CURRENT
    |-- LOCK
    |-- LOG
    |-- LOG.old
    `-- MANIFEST-000004

64 directories, 378 files
</code></pre>

<p>After performing a large number of PUT (write) operations, the Riak
cluster running eLevelDB will look something like this:</p>

<pre><code class="language-bash">tree leveldb
</code></pre>

<p>The result should look something like this:</p>

<pre><code>├── 0
│   ├── 000003.log
│   ├── CURRENT
│   ├── LOCK
│   ├── LOG
│   ├── MANIFEST-000002
│   ├── sst_0
│   ├── sst_1
│   ├── sst_2
│   ├── sst_3
│   ├── sst_4
│   ├── sst_5
│   └── sst_6
├── 1004782375664995756265033322492444576013453623296
│   ├── 000003.log
│   ├── CURRENT
│   ├── LOCK
│   ├── LOG
│   ├── MANIFEST-000002
│   ├── sst_0
│   ├── sst_1
│   ├── sst_2
│   ├── sst_3
│   ├── sst_4
│   ├── sst_5
│   └── sst_6

... etc ...
</code></pre>

<h2 id="tiered-storage:f3b9fd04cefdda84e52c48fa0009bd9f">Tiered Storage</h2>

<p>Google&rsquo;s original LevelDB implemented stored all <code>.sst</code> table files in a
single database directory. In Riak 1.3, the original LevelDB code was
modified to store <code>.sst</code> files in subdirectories representing each
&ldquo;level&rdquo; of the file, e.g. <code>sst_0</code> or <code>sst_1</code>, in the name of speeding up
database repair operations.</p>

<p>An additional advantage of this approach is that it enables Riak
operators to mount alternative storage devices at each level of a
LevelDB database. This can be an effective strategy because LevelDB is
write intensive in lower levels, with the write intensity declining as
the level number increases. This is due to LevelDB&rsquo;s storage strategy,
which places more frequently updated data in lower levels.</p>

<p>Because write intensity differs by level, performance can be improved by
mounting faster, more expensive storage arrays in lower levels and
slower, less expensive arrays at higher levels. Tiered storage enables
you to configure the level at which LevelDB switches from a faster array
to a slower array.</p>

<blockquote>
<p><strong>Note on write throttling</strong></p>

<p>High-volume, sustained write operations can occasionally fill the
higher-speed storage arrays before LevelDB has had the opportunity to
move data to the low-speed arrays. LevelDB&rsquo;s write throttle will slow
incoming write operations to allow compactions to catch up, as would be
the case when using a single storage array.</p>
</blockquote>

<h3 id="configuring-tiered-storage:f3b9fd04cefdda84e52c48fa0009bd9f">Configuring Tiered Storage</h3>

<p>If you are using the newer, <code>riak.conf</code>-based configuration system, the
following parameters can be used to configure LevelDB tiered storage:</p>

<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>leveldb.tiered</code></td>
<td align="left">The level number at which data should switch to the slower array. The default is <code>0</code>, which disables the feature.</td>
</tr>

<tr>
<td align="left"><code>leveldb.tiered.path.fast</code></td>
<td align="left">The path prefix for <code>.sst</code> files below the level set by <code>leveldb.tiered</code></td>
</tr>

<tr>
<td align="left"><code>leveldb.tiered.path.slow</code></td>
<td align="left">The path prefix for <code>.sst</code> files at and above the level set by <code>leveldb.tiered</code></td>
</tr>
</tbody>
</table>

<p>If you are using the older, <code>app.config</code>-based system, the example below
will show you the equivalents of the settings listed in the table above.</p>

<h4 id="example:f3b9fd04cefdda84e52c48fa0009bd9f">Example</h4>

<p>The following example LevelDB tiered storage
<a href="/riak/kv/2.1.3/configuring/reference">configuration</a> for Riak 2.0 sets the level for
switching storage arrays to 4 and the file path prefix to <code>fast_raid</code>
for the faster array and <code>slow_raid</code> for the slower array:</p>

<pre><code class="language-riakconf">leveldb.tiered = 4
leveldb.tiered.path.fast = /mnt/fast_raid
leveldb.tiered.path.slow = /mnt/slow_raid
</code></pre>

<pre><code class="language-appconfig">{eleveldb, [
    {tiered_slow_level, 4},
    {tiered_fast_prefix, &quot;/mnt/fast_raid&quot;},
    {tiered_slow_prefix, &quot;/mnt/slow_raid&quot;}
]}
</code></pre>

<p>With this configuration, level directories <code>sst_0</code> through <code>sst_3</code> will
be stored in <code>/mnt/fast_raid</code>, while directories <code>sst_4</code> and <code>sst_6</code>
will be stored in <code>/mnt/slow_raid</code>.</p>

<h3 id="selecting-a-level:f3b9fd04cefdda84e52c48fa0009bd9f">Selecting a Level</h3>

<p>LevelDB will perform optimally when as much data as possible is stored
in the faster array. The amount of data that can be stored in the faster
array depends on the size of your array and the total number of LevelDB
databases (i.e. the total number of Riak <a href="/riak/kv/2.1.3/learn/glossary/#Vnode">vnodes</a>)
in your cluster. The following table shows approximate sizes (in
megabytes) for each of the following sizes: the amount of raw data
stored in the level, the cumulative size of all levels up to the
specified level, and the cumulative size including active anti-entropy
data.</p>

<table>
<thead>
<tr>
<th align="left">Level</th>
<th align="left">Level Size</th>
<th align="left">Cumulative Size</th>
<th align="left">Cumulative with AAE</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">0</td>
<td align="left">360</td>
<td align="left">360</td>
<td align="left">720</td>
</tr>

<tr>
<td align="left">1</td>
<td align="left">2,160</td>
<td align="left">2,520</td>
<td align="left">5,040</td>
</tr>

<tr>
<td align="left">2</td>
<td align="left">2,940</td>
<td align="left">5,460</td>
<td align="left">10,920</td>
</tr>

<tr>
<td align="left">3</td>
<td align="left">6,144</td>
<td align="left">11,604</td>
<td align="left">23,208</td>
</tr>

<tr>
<td align="left">4</td>
<td align="left">122,880</td>
<td align="left">134,484</td>
<td align="left">268,968</td>
</tr>

<tr>
<td align="left">5</td>
<td align="left">2,362,232</td>
<td align="left">2,496,716</td>
<td align="left">4,993,432</td>
</tr>

<tr>
<td align="left">6</td>
<td align="left">not limited</td>
<td align="left">not limited</td>
<td align="left">not limited</td>
</tr>
</tbody>
</table>

<p>To select the appropriate value for <code>leveldb.tiered</code>, use the following
steps:</p>

<ul>
<li>Determine the value of (ring size) / (N - 1), where ring size is the
value of the <code>ring_size</code> configuration parameter and N is the number
of nodes in the cluster. For a <code>ring_size</code> of 128 and a cluster with
10 nodes, the value would be 14.</li>
<li>Select either the <strong>Cumulative Size</strong> or <strong>Cumulative with AAE</strong>
column from the table above. Select the third column if you are not
using active anti-entropy or the fourth column if you are (i.e. if the
<code>anti_entropy</code> <a href="/riak/kv/2.1.3/configuring/reference/#Active-Anti-Entropy">configuration parameter</a> is set to <code>active</code>).</li>
<li>Multiply the value from the first step by the cumulative column in
each row in the table. The first result that exceeds your fast storage
array capacity will provide the level number that should be used for
your <code>leveldb.tiered</code> setting.</li>
</ul>

<h3 id="migrating-from-one-configuration-to-another:f3b9fd04cefdda84e52c48fa0009bd9f">Migrating from One Configuration to Another</h3>

<p>If you want to use tiered storage in a new Riak installation, you don&rsquo;t
need to take any steps beyond setting configuration. The rest is
automated.</p>

<p>But if you&rsquo;d like to use tiered storage in an existing installation that
is not currently using it, you will need to manually move your
installation&rsquo;s <code>.sst</code> files from one configuration to another.</p>


      <div class="clear"></div>

    </article>

    <footer class="mastfooter">
    This work is licensed under a
    <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
        Creative Commons Attribution 4.0 International Public License
    </a><br>
    &copy; 2011-2016&nbsp;<a href="http://www.basho.com">Basho Technologies, Inc.</a>
</footer>


  </div>

  <script src="/js/all.js" type="text/javascript"></script>
<script type= "text/javascript">
  
  hljs.configure({languages: []});
  hljs.initHighlighting();

  
  
  
  $(function() {
    $(".js_enabled pre").css("visibility", "visible");
  });
</script>


</body>
</html>
